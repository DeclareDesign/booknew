---
title: "Redesign"
output: html_document
bibliography: ../bib/book.bib 
---

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
```{r, eval = !exists("do_bookdown"), echo = FALSE, include = FALSE, purl = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()) # files are all relative to RStudio project home
```

```{r, eval = !exists("do_bookdown"), echo = FALSE, include = FALSE, purl = FALSE}
# load common packages, set ggplot ddtheme, etc.
source("scripts/before_chapter_script.R")
```

<!-- start post here, do not edit above -->

# Redesign

<!-- make sure to rename the section title below -->

```{r redesign, echo = FALSE, output = FALSE, purl = FALSE}
# run the diagnosis (set to TRUE) on your computer for this section only before pushing to Github. no diagnosis will ever take place on github.
do_diagnosis <- FALSE
sims <- 100
b_sims <- 20
```

```{r, echo = FALSE}
# load packages for this section here. note many (DD, tidyverse) are already available, see scripts/package-list.R
```



Redesign is about changing design parameters to understand their effects on diagnosands. 

The most common redesign is a tweak to the data strategy: varying $N$ to see what samples yields statistical power of 80\%. Redesign can take place with respect to any of $M$, $I$, $D$, and $A$, with possible consequences for the diagnosands. 

The redesign process is about enumerating a family of feasible designs, then selecting the best one, where "best" is determined by the diagnosands.

The highest level advice we have about redesign is, at the beginning of the processes at least, change one design parameter at a time. Vary the data strategy, holding the model, inquiry, and answer strategy constant. Change the answer strategy, while holding the other aspects of the design constant. 

Redesign with respect to a model: I want to know that I'm right when I'm right, and I want to know that I'm wrong when I'm wrong. That's with respect to *TWO* models.


Diagnosis is like this:

(we need a math glyph for left relation composition notation)

$$
MIDA |> \\
  simulate |> \\
  summarize
$$

Redesign is like this

$$
map(parameters) |> \\
  MIDA |>  \\
  simulate |> \\ 
  group\_by(parameters) |> \\
  summarize
$$



## Redesign Mountain


This figure shows a schematic of the redesign process. We vary design parameter 1 and design parameter 2 independently to learn the value of the diagnosand for each combination of design parameters. The redesign process can be in more than 2 dimensions of course. We suggest varying the design parameters you have control over first.

```{r, echo=FALSE}
expand.grid(param_1 = seq(0, 1, length.out = 100),
            param_2 = seq(0, 1, length.out = 100)) %>%
  mutate(diagnosand = 1 - sqrt((param_1 - 0.3) ^ 2 + (param_2 - 0.7) ^ 2)) %>%
  ggplot(aes(param_1, param_2)) + 
  geom_tile(aes(fill = diagnosand)) +
  geom_point(x = 0.3, y = 0.7, size = 2) +
  geom_contour(aes(z = diagnosand)) +
  scale_fill_gradient(low = "blue", high = "red") +
  labs(x = "Design Parameter 1",
       y = "Design Parameter 2",
       title = "Diagnosands change as design parameters change")

```









## Redesign to assess the robustness of designs to models [GB]

- Hold inquiry constant! (read Richard Crump “Moving the Goalposts”)
- Hold three constant, vary one of MIDA at a time
- M: ICC, null model, alternative DAGs, heterogeneity
- I:
