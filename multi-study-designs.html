<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 18 Multi-study designs | Research Design: Declare, Diagnose, Redesign</title>
<meta name="author" content="Graeme Blair, Alexander Coppock, and Macartan Humphreys">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<link href="libs/bs4_book-1.0.0/dd_imgpopup.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/bs4_book-1.0.0/dd_imgpopup.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://hypothes.is/embed.js" async></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Research Design: Declare, Diagnose, Redesign</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li class="book-part">Introduction</li>
<li><a class="" href="preamble.html"><span class="header-section-number">1</span> Preamble</a></li>
<li><a class="" href="improving-research-designs.html"><span class="header-section-number">2</span> Improving research designs</a></li>
<li><a class="" href="primer.html"><span class="header-section-number">3</span> Software primer</a></li>
<li><a class="" href="part-i-exercises.html"><span class="header-section-number">4</span> Part I Exercises</a></li>
<li class="book-part">Declaration, Diagnosis, Redesign</li>
<li><a class="" href="declaration.html"><span class="header-section-number">5</span> Declaration</a></li>
<li><a class="" href="specifying-the-model.html"><span class="header-section-number">6</span> Specifying the model</a></li>
<li><a class="" href="defining-the-inquiry.html"><span class="header-section-number">7</span> Defining the inquiry</a></li>
<li><a class="" href="crafting-a-data-strategy.html"><span class="header-section-number">8</span> Crafting a data strategy</a></li>
<li><a class="" href="choosing-an-answer-strategy.html"><span class="header-section-number">9</span> Choosing an answer strategy</a></li>
<li><a class="" href="p2diagnosis.html"><span class="header-section-number">10</span> Diagnosis</a></li>
<li><a class="" href="redesign-2.html"><span class="header-section-number">11</span> Redesign</a></li>
<li><a class="" href="part-ii-exercises.html"><span class="header-section-number">12</span> Part II Exercises</a></li>
<li class="book-part">Research Design Library</li>
<li><a class="" href="research-design-library.html"><span class="header-section-number">13</span> Research Design Library</a></li>
<li><a class="" href="observational-designs-for-descriptive-inference.html"><span class="header-section-number">14</span> Observational designs for descriptive inference</a></li>
<li><a class="" href="experimental-designs-for-descriptive-inference.html"><span class="header-section-number">15</span> Experimental designs for descriptive inference</a></li>
<li><a class="" href="observational-designs-for-causal-inference.html"><span class="header-section-number">16</span> Observational designs for causal inference</a></li>
<li><a class="" href="experimental-designs-for-causal-inference.html"><span class="header-section-number">17</span> Experimental designs for causal inference</a></li>
<li><a class="active" href="multi-study-designs.html"><span class="header-section-number">18</span> Multi-study designs</a></li>
<li><a class="" href="part-iii-exercises.html"><span class="header-section-number">19</span> Part III Exercises</a></li>
<li class="book-part">Research Design Lifecycle</li>
<li><a class="" href="research-design-lifecycle.html"><span class="header-section-number">20</span> Research Design Lifecycle</a></li>
<li><a class="" href="before.html"><span class="header-section-number">21</span> Before</a></li>
<li><a class="" href="during.html"><span class="header-section-number">22</span> During</a></li>
<li><a class="" href="after.html"><span class="header-section-number">23</span> After</a></li>
<li><a class="" href="part-iv-exercises.html"><span class="header-section-number">24</span> Part IV Exercises</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="multi-study-designs" class="section level1">
<h1>
<span class="header-section-number">18</span> Multi-study designs<a class="anchor" aria-label="anchor" href="#multi-study-designs"><i class="fas fa-link"></i></a>
</h1>
<p>In the designs we presented thus far, each design represents a single “study.” One set of observations was collected about one set of units. Many social science papers, however, present the results from multiple analyses from multiple data strategies. In this section, we consider declaring and diagnosing multi-study designs. The key addition in each case will be a function that summarizes the results across components of the study.</p>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
<div id="three-study-papers" class="section level2">
<h2>
<span class="header-section-number">18.1</span> Three-study papers<a class="anchor" aria-label="anchor" href="#three-study-papers"><i class="fas fa-link"></i></a>
</h2>
<!-- make sure to rename the section title below -->
<p>In many research projects, we seek to evaluate multiple observable implications for a single theory. In such cases, a single piece of evidence does not constitute sufficient evidence to validate the theory as a whole. Rather, we believe in the theory when multiple pieces of evidence support it.
<!-- [Examples: Psychology; APSR articles that have an experiment plus observational work; replication efforts.] --></p>
<p>Conventions around what constitutes a convincing pattern of evidence vary. Some researchers will not believe a theory unless each piece of evidence in support of it is <em>statistically significant</em>.
<!-- Reviewer / skeptic: an observable implication is X.  -->
<!-- You have failed to provide evidence of X, this is inconsistent with your theory. -->
Less stringent approaches simply seek evidence “consistent” with the theory, such as the observation that all effects are signed in the predicted direction.</p>
<p>Here, we declare an <span class="math inline">\(N\)</span>-study design, and examine the consequences of these two different approaches to evaluating a theory in light of multiple studies. We show that, under multiple observable implications generated by the same process, conditioning on significance can lead one strongly astray. Generally speaking, looking at the sign of effects is more probative because it is much less prone to false negatives. With small numbers of studies, however, the risks of false positives are high.</p>
<div id="design-declaration" class="section level3">
<h3>
<span class="header-section-number">18.1.1</span> Design Declaration<a class="anchor" aria-label="anchor" href="#design-declaration"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p><strong>M</strong>odel: We declare <span class="math inline">\(N\)</span> populations, all of which are governed by the same
data-generating process: <code>X</code> is exogenous and standard normally-distributed,
<code>M</code> is standard-normally distributed and correlated with <code>X</code> by <code>rho</code>, and <code>Y</code> is a function of the main effect of <code>X</code> as well as the interaction between <code>X</code> and <code>M</code>, with the size and sign of the direct and interactive effects determined by <code>tau</code> and <code>gamma</code>, respectively.</p></li>
<li><p><strong>I</strong>nquiry: We want to know, in a global sense, if our theory is “right.”
Here, that means that the effect of <code>X</code> on <code>Y</code> is positive and increasing with <code>M</code>, and that <code>X</code> affects <code>M</code>.
When <code>tau</code> is positive, our theory is correct. When it is zero or negative, our theory is incorrect.</p></li>
<li><p><strong>D</strong>ata strategy: We conduct and collect independent datasets on <span class="math inline">\(N\)</span> datasets of size <code>n</code>. In the example below, we conduct three studies, assuming we only observe <code>X</code> and <code>Y</code> in the first, only <code>M</code> and <code>X</code> in the second, and <code>Y</code>, <code>M</code>, and <code>X</code>, in the third.</p></li>
<li><p><strong>A</strong>nswer strategy: Using linear regression, we estimate the bivariate correlation between <code>X</code> and <code>Y</code> in study 1, the bivariate correlation between <code>X</code> and <code>M</code> in study 2, and the interaction between <code>X</code> and <code>M</code> on <code>Y</code> in study 3.</p></li>
</ul>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">n3</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">.5</span>
<span class="va">gamma</span> <span class="op">&lt;-</span> <span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">.2</span>

<span class="va">generate_study_sample</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">rho</span>, <span class="va">tau</span>, <span class="va">gamma</span>, <span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">fabricate</span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span>, X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">X</span> <span class="op">*</span> <span class="va">rho</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">rho</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, 
            U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, Y <span class="op">=</span> <span class="va">tau</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">M</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">U</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">three_study_design</span> <span class="op">&lt;-</span>
  <span class="co"># Study 1 -- Bivariate correlation between X and Y</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    n <span class="op">=</span> <span class="va">n1</span>,
    tau <span class="op">=</span> <span class="va">tau</span>,
    gamma <span class="op">=</span> <span class="va">gamma</span>,
    rho <span class="op">=</span> <span class="va">rho</span>,
    handler <span class="op">=</span> <span class="va">generate_study_sample</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>,
                    term <span class="op">=</span> <span class="st">"X"</span>,
                    model <span class="op">=</span> <span class="va">lm_robust</span>,
                    label <span class="op">=</span> <span class="st">"Study 1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Study 2 -- Bivariate correlation between M and X</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    n <span class="op">=</span> <span class="va">n2</span>,
    tau <span class="op">=</span> <span class="va">tau</span>,
    gamma <span class="op">=</span> <span class="va">gamma</span>,
    rho <span class="op">=</span> <span class="va">rho</span>,
    handler <span class="op">=</span> <span class="va">generate_study_sample</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">M</span> <span class="op">~</span> <span class="va">X</span>,
                    term <span class="op">=</span> <span class="st">"X"</span>,
                    model <span class="op">=</span> <span class="va">lm_robust</span>,
                    label <span class="op">=</span> <span class="st">"Study 2"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Study 3 -- Interaction in X and M</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    n <span class="op">=</span> <span class="va">n3</span>,
    tau <span class="op">=</span> <span class="va">tau</span>,
    gamma <span class="op">=</span> <span class="va">gamma</span>,
    rho <span class="op">=</span> <span class="va">rho</span>,
    handler <span class="op">=</span> <span class="va">generate_study_sample</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">M</span> <span class="op">+</span> <span class="va">X</span><span class="op">:</span><span class="va">M</span>,
                    term <span class="op">=</span> <span class="st">"X:M"</span>,
                    model <span class="op">=</span> <span class="va">lm_robust</span>,
                    label <span class="op">=</span> <span class="st">"Study 3"</span><span class="op">)</span> </code></pre></div>
</div>
<div id="dag-22" class="section level3">
<h3>
<span class="header-section-number">18.1.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-22"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-336-1.svg" width="100%"></div>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-337-1.svg" width="100%"></div>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-338-1.svg" width="100%"></div>
</div>
<div id="takeaways-1" class="section level3">
<h3>
<span class="header-section-number">18.1.3</span> Takeaways<a class="anchor" aria-label="anchor" href="#takeaways-1"><i class="fas fa-link"></i></a>
</h3>
<p>Let us compare the performance of the “all significant” versus “all signed”
approaches to theory confirmation when the theory is “correct” (<code>tau</code> and <code>gamma</code> positive),
versus when it is “incorrect” (both parameters zero).
In the first approach, a theory is deemed “supported” by the evidence when all effects
are significant. In the second, the theory is supported by the evidence when the signs of all effects are positive.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Simulate design</span>
<span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fu">simulate_design</span><span class="op">(</span><span class="va">three_study_design</span><span class="op">)</span>

<span class="co"># Simulate null design</span>
<span class="va">null_three_study_design</span> <span class="op">&lt;-</span> 
  <span class="fu">redesign</span><span class="op">(</span><span class="va">three_study_design</span>, tau <span class="op">=</span> <span class="fl">0</span>, gamma <span class="op">=</span> <span class="fl">0</span>, rho <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">null_simulations</span> <span class="op">&lt;-</span> <span class="fu">simulate_design</span><span class="op">(</span><span class="va">null_three_study_design</span><span class="op">)</span></code></pre></div>
<p>In the first three rows of the table, the theory is correct in that <code>tau</code>, <code>gamma</code>, and <code>rho</code> are positive; in the second three rows, it is incorrect because both the main effect and interaction are zero. The “power” column tells us the proportion of simulations in which the effect is significant at the <span class="math inline">\(\alpha = .05\)</span> level, the “all significant” column tells us the proportion of simulations in which all of the studies have significant effects, the “positive” column tells us how often the study found a positively signed result, while the “all positive column” tells us the proportion of simulations where all studies had a positively signed result.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
tau
</th>
<th style="text-align:left;">
estimator_label
</th>
<th style="text-align:right;">
gamma
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
all_significant
</th>
<th style="text-align:right;">
positive
</th>
<th style="text-align:right;">
all_positive
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
Study 1
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.406
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.968
</td>
<td style="text-align:right;">
0.938
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
Study 2
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.998
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.938
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
Study 3
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.616
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.966
</td>
<td style="text-align:right;">
0.938
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:left;">
Study 1
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.058
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.500
</td>
<td style="text-align:right;">
0.114
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:left;">
Study 2
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.052
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.506
</td>
<td style="text-align:right;">
0.114
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:left;">
Study 3
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.060
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.530
</td>
<td style="text-align:right;">
0.114
</td>
</tr>
</tbody>
</table></div>
<ul>
<li><p>Notice that, because the studies are independent, the probability that all
are significant is equal to the product of their power:
Pr(all studies significant) = Pr(Study 1 significant) <span class="math inline">\(\times\)</span>…<span class="math inline">\(\times\)</span> Pr(Study <span class="math inline">\(N\)</span> significant). Thus, if you only believe a theory if the studies conducted to test it yield significant results, and those studies are all powered at the conventionally accepted level of 80%, you erroneously reject the theory with a probability of <span class="math inline">\(.8^N\)</span>. If you do three, conventionally well-powered, randomized studies each shooting at the right quantity of interest, then in almost half of the cases where you are right, you will think
you are wrong.</p></li>
<li><p>Furthermore, notice how detrimental the addition of a small study can be by this metric, even if it gets at an important mechanism. As soon as you condition your inference about the theory being correct on the significance of all the observable implications, a low-powered test can sharply increase the risk of false rejection.</p></li>
<li><p>What can we say about the risk of false positives? The power of the individual studies is where it should be: for a stated error rate of <span class="math inline">\(\alpha = 0.05\)</span>, the studies are every so slightly anti-conservative. However, the “all significant” desideratum creates a rejection rate that is too high.</p></li>
<li><p>Some of these problems, though not all, are alleviated when we disregard significance and just look at signs. When the theory is right, there is a very good chance that all of the effects we estimate are positive: we surmise the theory is correct roughly 94% of the time when it actually is.</p></li>
<li><p>When the theory is not correct in the sense that the true effects are zero, random error means that they are positive half the time and negative the other half. Consequently, the probability of erroneously accepting the theory based on the sign of effects when the true underlying effects are zero is equal to <span class="math inline">\(0.5^N\)</span>. Here, that means we erroneously infer we are right at a relatively high rate of 12% of simulations.</p></li>
</ul>
<p>In the design above, the rates at which we rejected or accepted theories seemed
to depend on the number of studies we considered. In the graph below, we look
at twenty-nine different <span class="math inline">\(N\)</span>-study designs, all of which seek to confirm a theory
by replicating evidence for it <span class="math inline">\(N\)</span> times. The first design is made of two studies,
each independently evaluating the hypothesis that <span class="math inline">\(Y\)</span> is positively correlated with <span class="math inline">\(X\)</span>.
Again, we consider how conditioning an inference about the theory on whether
all results are significant or all results are positive affects error rates.</p>
<ul>
<li><p>Again, we see that significance is not a probative way to look for observable
theoretical implications. As soon as there are more than four studies,
there is virtually no chance of confirming even a true theory by this metric.
We see a sort of reverse multiple-comparisons problem: increasing the number
of tests makes false rejections increasingly more likely when we are interested
in the joint probability of all the tests saying the same thing.
Unless the number of studies is small, whether all produce significant results
essentially yields no information about whether the theory is correct.</p></li>
<li><p>By contrast, looking at signs only can be highly probative. In this
application, the optimal number of studies is about eight. At that point,
there is virtually no chance of erroneously inferring that the theory is
correct when the effects are zero, but when the theory is correct there is
a good chance (almost 75%) that all of the available evidence will be signed
accordingly. As the number of studies increases, so too does the probability
of discordant results, and using the unanimity of signs to judge whether
the theory is correct becomes increasingly unwise.</p></li>
</ul>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-346-1.svg" width="100%"></div>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
<!-- make sure to rename the section title below -->
</div>
</div>
<div id="multi-site-trials" class="section level2">
<h2>
<span class="header-section-number">18.2</span> Multi-site trials<a class="anchor" aria-label="anchor" href="#multi-site-trials"><i class="fas fa-link"></i></a>
</h2>
<!-- ## The Metaketa design -->
<!-- | Study Number | Place | What Works   | Design Implemented | Success? | -->
<!-- | ------------ | ----- | ------------ | ------------------ | -------- | -->
<!-- | 1            | A     | $Y_A ~ Z_A$  | $MIDA_A$           | Yes      | -->
<!-- | 2            | B     | $Y_B ~ Z_B$  | $MIDA_B$           | Yes      | -->
<!-- | 3            | C     | $Y_C ~ Z_C$  | $MIDA_C$           | Yes      | -->
<!-- | 4            | D     | $Y_D ~ Z_D$  | $MIDA_D$           | Yes      | -->
<!-- | 5            | E     | $Y_E ~ Z_E$  | $MIDA_E$           | Yes      | -->
<!-- The worry is that $I_A$ and $I_B$ etc are fundamentally different inquiries about different dags -->
<!-- [faceted figure of 5 different DAGs with nodes in different languages roman, greek, numeric, windings].  The purpose of *theory* is to tell us when the $I$'s across context are different, but that is HARD and that is how research has gone for YEARS. -->
<!-- The metaketa design says WAIT -- LET'S agree on a $MIDA_{MK}$ that we will implement in all 5 places, mutatis mutandis. That is, everyone "localizes" their design because things work slightly differently in different places, but if we try hard, we can implement the same "important" treatment on the same "important" outcome, even though the details (like the language of the treatment materials, the specifics of the measurement strategies.) will differ from place to place. -->
<!-- | Study Number | Place | What Works   | Design Implemented                               | Success? | -->
<!-- | ------------ | ----- | ------------ | ------------------------------------------------ | -------- | -->
<!-- | 1            | A     | $Y_A ~ Z_A$  | $\delta_A * MIDA_{MK} - (1 - \delta_A) * MIDA_A$ | ?        | -->
<!-- | 2            | B     | $Y_B ~ Z_B$  | $\delta_B * MIDA_{MK} - (1 - \delta_B) * MIDA_B$ | ?        | -->
<!-- | 3            | C     | $Y_C ~ Z_C$  | $\delta_C * MIDA_{MK} - (1 - \delta_C) * MIDA_C$ | ?        | -->
<!-- | 4            | D     | $Y_D ~ Z_D$  | $\delta_D * MIDA_{MK} - (1 - \delta_D) * MIDA_D$ | ?        | -->
<!-- | 5            | E     | $Y_E ~ Z_E$  | $\delta_E * MIDA_{MK} - (1 - \delta_E) * MIDA_E$ | ?        | -->
<!-- Coordinating trials like the metaketa design means causing teams to implement designs that they otherwise would not have. Collaboration can bring many benefits and shared struggle, but fundamentally, it pulls all the designs towards the common $MIDA_{MK}$ design. The strength of the pull is given by the $\delta$ parameters.  -->
<!-- Will the metaketa design be a success? Only if (1) the $MIDA_{MK}$ design is a strong one and it is correct about how $Y$ and $Z$ relate. If the $MIDA_{MK}$ design is poor, however, then all the studies will be a failure. Instead of learning $I_A$ in place $A$ and learning $I_B$ in place $B$, we learn nothing anywhere.  -->
<!-- The trouble with the standard approach (separate teams investigating phenomena that later theory tries to label as instances of the same thing) is that theory is hard and we can never really be sure if $I_A$ means the same thing for $M_A$ as $I_B$ means for $M_B$. The metaketa design tries to solve this theoretical problem on the front end -- let's agree on what the $M$ we all have in mind is (with local variations), then run a study. This approach works well if the $M$ we all agree on is approximately correct, and it works *worse* than the standard approach if we're wrong. -->
<p>The starting point is a fixed budget and considering two possible designs: (1) a single large study in one context or (2) a set of five studies in five different contexts with the same intervention and outcome measures.</p>
<p>When there are heterogeneous effects, you can get good predictions out of sample even when average effects differ substantially (and you do better with multiple sites when sites in the population have different proportions of subject types that are correlated with heterogeneous effects).</p>
<p>Two notable features of the design:
- there must be heterogeneous effects for this to work (otherwise our estimates get biased toward zero due to overfitting to the variables).
- we have to have information about the covariate in the population and the sample (here we used the proportion of people in each heterogeneous type).</p>
<!-- Findings: -->
<!-- - these two strategies are both unbiased -->
<!-- - the design with five sites has half the RMSE of the one-site design. this is because of the variation in the proportions of types across sites. -->
<!-- - interestingly there is poor coverage (anti-conservative) when you use the single site design -->
<!-- (when you have contextual variation as well, i.e. effect differs across sites for reasons not captured by the het fx, coverage is off for all designs. will keep this point out, seems like too much and you don't need contextual effects to get different effects across sites, those come from different proportions of types) -->
<!-- need to have biased sampling to get bias here -->
<!-- two kinds of populations, one in which the study type determines the subject types and you select on study type -->
<!--   a second kind where study type determines study shock  -->
<!--   in second type if you adjust for subject type then you will be able to unbiased recover global -->
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">single_site_design</span> <span class="op">&lt;-</span> 
  <span class="fu">declare_population</span><span class="op">(</span>
    site <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>
      N <span class="op">=</span> <span class="fl">10</span>, 
      feasible_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
      study_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.1</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span> 
    <span class="op">)</span>,
    subjects <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="va">n_subjects_per_site</span>, noise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">study_effect</span> <span class="op">+</span> <span class="fl">0.025</span> <span class="op">*</span> <span class="va">feasible_site</span><span class="op">)</span> <span class="op">+</span> <span class="va">noise</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>PATE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_estimand</span><span class="op">(</span>PATE_feasible <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span>, subset <span class="op">=</span> <span class="va">feasible_site</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_sampling</span><span class="op">(</span>clusters <span class="op">=</span> <span class="va">site</span>, strata <span class="op">=</span> <span class="va">feasible_site</span>, strata_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_sampling</span><span class="op">(</span>strata <span class="op">=</span> <span class="va">site</span>, n <span class="op">=</span> <span class="va">n_subjects_per_site</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_assignment</span><span class="op">(</span>blocks <span class="op">=</span> <span class="va">site</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>, model <span class="op">=</span> <span class="va">lm_robust</span><span class="op">)</span>

<span class="va">multi_site_design</span> <span class="op">&lt;-</span> 
  <span class="fu">declare_population</span><span class="op">(</span>
    site <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>
      N <span class="op">=</span> <span class="fl">10</span>, 
      feasible_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
      study_effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.1</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span> 
    <span class="op">)</span>,
    subjects <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="va">n_subjects_per_site</span>, noise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0.1</span> <span class="op">+</span> <span class="va">study_effect</span> <span class="op">+</span> <span class="fl">0.025</span> <span class="op">*</span> <span class="va">feasible_site</span><span class="op">)</span> <span class="op">+</span> <span class="va">noise</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>PATE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_estimand</span><span class="op">(</span>PATE_feasible <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span>, subset <span class="op">=</span> <span class="va">feasible_site</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_sampling</span><span class="op">(</span>clusters <span class="op">=</span> <span class="va">site</span>, strata <span class="op">=</span> <span class="va">feasible_site</span>, strata_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_study_sites</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_sampling</span><span class="op">(</span>strata <span class="op">=</span> <span class="va">site</span>, n <span class="op">=</span> <span class="va">n_subjects_per_site</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_assignment</span><span class="op">(</span>blocks <span class="op">=</span> <span class="va">site</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">declare_estimator</span><span class="op">(</span>handler <span class="op">=</span> <span class="fu">label_estimator</span><span class="op">(</span><span class="va">random_effects_meta_analysis</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"random-effects"</span><span class="op">)</span>

<span class="va">single_site_large_design</span> <span class="op">&lt;-</span> <span class="fu">redesign</span><span class="op">(</span><span class="va">single_site_design</span>, n_subjects_per_site <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span>

<span class="va">small_study_five_sites</span> <span class="op">&lt;-</span> <span class="fu">redesign</span><span class="op">(</span><span class="va">multi_site_design</span>, n_study_sites <span class="op">=</span> <span class="fl">5</span>, n_subjects_per_site <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simulations_small_large</span> <span class="op">&lt;-</span> <span class="fu">simulate_design</span><span class="op">(</span><span class="va">single_site_large_design</span>, <span class="va">small_study_five_sites</span>, sims <span class="op">=</span> <span class="va">sims</span><span class="op">)</span>
<span class="va">diagnosis_small_large</span> <span class="op">&lt;-</span> <span class="fu">diagnose_design</span><span class="op">(</span><span class="va">simulations_small_large</span>, bootstrap_sims <span class="op">=</span> <span class="va">b_sims</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Design Label
</th>
<th style="text-align:left;">
Estimand Label
</th>
<th style="text-align:left;">
Bias
</th>
<th style="text-align:left;">
RMSE
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
single_site_large_design
</td>
<td style="text-align:left;">
PATE
</td>
<td style="text-align:left;">
0.00
</td>
<td style="text-align:left;">
0.07
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
<tr>
<td style="text-align:left;">
single_site_large_design
</td>
<td style="text-align:left;">
PATE_feasible
</td>
<td style="text-align:left;">
-0.00
</td>
<td style="text-align:left;">
0.07
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
<tr>
<td style="text-align:left;">
small_study_five_sites
</td>
<td style="text-align:left;">
PATE
</td>
<td style="text-align:left;">
0.01
</td>
<td style="text-align:left;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
<tr>
<td style="text-align:left;">
small_study_five_sites
</td>
<td style="text-align:left;">
PATE_feasible
</td>
<td style="text-align:left;">
0.00
</td>
<td style="text-align:left;">
0.04
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
</tbody>
</table></div>
<div id="bayesian-estimation-can-improve-estimates-of-effects-for-sampled-sites" class="section level3">
<h3>
<span class="header-section-number">18.2.1</span> Bayesian estimation can improve estimates of effects for sampled sites<a class="anchor" aria-label="anchor" href="#bayesian-estimation-can-improve-estimates-of-effects-for-sampled-sites"><i class="fas fa-link"></i></a>
</h3>
<p>To do: you can improve site-level effect estimates by analyzing with a simple Bayesian model because of its shrinkage property, even when the Bayesian model is wrong about distribution of effects in population.</p>
<!-- this is the point from the blog post; I will modify the above design so it can also make this point, switching between the normal distribution and uniform distribution for the fx distribution -->
<!-- # ```{r, eval = FALSE} -->
<!-- # stan_model <- "  -->
<!-- # data { -->
<!-- #   int<lower=0> J;         // number of sites  -->
<!-- #   real y[J];              // estimated effects -->
<!-- #   real<lower=0> sigma[J]; // s.e. of effect estimates  -->
<!-- # } -->
<!-- # parameters { -->
<!-- #   real mu;  -->
<!-- #   real<lower=0> tau; -->
<!-- #   real eta[J]; -->
<!-- # } -->
<!-- # transformed parameters { -->
<!-- #   real theta[J]; -->
<!-- #   real tau_sq = tau^2; -->
<!-- #   for (j in 1:J) -->
<!-- #     theta[j] = mu + tau * eta[j]; -->
<!-- # } -->
<!-- # model { -->
<!-- #   target += normal_lpdf(eta | 0, 1); -->
<!-- #   target += normal_lpdf(y | theta, sigma); -->
<!-- # } -->
<!-- # " -->
<!-- #  -->
<!-- # stan_re_estimator <- function(data) { -->
<!-- #   site_estimates_df <- data %>%  -->
<!-- #     group_by(site) %>%  -->
<!-- #     do(tidy(lm_robust(Y ~ Z, data = .))) %>%  -->
<!-- #     filter(term == "Z") %>%  -->
<!-- #     ungroup  -->
<!-- #    -->
<!-- #   J      <- nrow(site_estimates_df) -->
<!-- #   df     <- list(J = J, y = site_estimates_df$estimate, sigma = site_estimates_df$std.error) -->
<!-- #   fit    <- stan(model_code = stan_model, data = site_estimates_df) -->
<!-- #   fit_sm <- summary(fit)$summary -->
<!-- #   data.frame(estimate = fit_sm[,1][c("mu", "tau", "theta[1]", "prob_pos")]) -->
<!-- # } -->
<!-- #  -->
<!-- # bayes_estimator <- declare_estimator(handler = stan_re_estimator) -->
<!-- # ``` -->
<!-- ### When things break down: confounded sampling -->
<!-- None of these designs work when you're trying to make predictions for sites that are systematically different, i.e. are not in the same population as the sampling frame. -->
<!-- The design was set up to include several sites where researchers could not feasibly set up experiments. in the original design, effects do not depend on whether sites are feasible for the experiment. When effects do vary, there are systematic differences for those target sites. Those differences might come from three sources: mean effect size differs in places that are sampled vs not sampled; individual-level heterogeneous effect sizes that systematically differ in places that are sampled to study vs others; or covariate profiles that do not exist in sites outside the sampling frame. We introduce effects in the first way and show there is substantial bias. -->
<!-- ```{r} -->
<!-- small_study_five_sites_feasible_effects <- multi_site_designer(n_study_sites = 5, n_subjects_per_site = 500, feasible_effect  = -0.25) -->
<!-- ``` -->
<!-- ```{r, warning = FALSE, eval = do_diagnosis & !exists("do_bookdown")} -->
<!-- simulations_feasible_effects <- simulate_design(small_study_five_sites_feasible_effects, sims = sims) -->
<!-- diagnosis_feasible_effects <- diagnose_design(simulations_feasible_effects %>% filter(!is.na(estimate) & !is.na(std.error) & !is.na(statistic) & !is.na(p.value) & !is.na(conf.low) & !is.na(conf.high)), bootstrap_sims = b_sims) -->
<!-- ``` -->
<!-- ```{r, echo = FALSE, purl = FALSE} -->
<!-- # figure out where the dropbox path is, create the directory if it doesn't exist, and name the RDS file -->
<!-- rds_file_path <- paste0(get_dropbox_path("multi_site_studies"), "/diagnosis_feasible_effects.RDS") -->
<!-- if (do_diagnosis & !exists("do_bookdown")) { -->
<!--   write_rds(diagnosis_feasible_effects, path = rds_file_path) -->
<!-- } -->
<!-- diagnosis_feasible_effects <- read_rds(rds_file_path) -->
<!-- ``` -->
<!-- ```{r, echo = FALSE} -->
<!-- kable(get_diagnosands(diagnosis_feasible_effects) %>% reshape_diagnosis %>% select(Bias, RMSE), booktabs = TRUE, caption = "Diagnosis with confounded sampling,", digits = 3) -->
<!-- ``` -->
<!-- Other points I decided to abandon to keep this simple: -->
<!-- - tradeoff: context-specific interventions and comparability of intervention effects -->
<!-- - tradeoff: comparability and fidelity to context in outcome measurement -->

<!-- bibliography: ../../bib/book.bib  -->
<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="experimental-designs-for-causal-inference.html"><span class="header-section-number">17</span> Experimental designs for causal inference</a></div>
<div class="next"><a href="part-iii-exercises.html"><span class="header-section-number">19</span> Part III Exercises</a></div>
</div></main><div id="on-this-page-nav" class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multi-study-designs"><span class="header-section-number">18</span> Multi-study designs</a></li>
<li>
<a class="nav-link" href="#three-study-papers"><span class="header-section-number">18.1</span> Three-study papers</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#design-declaration"><span class="header-section-number">18.1.1</span> Design Declaration</a></li>
<li><a class="nav-link" href="#dag-22"><span class="header-section-number">18.1.2</span> DAG</a></li>
<li><a class="nav-link" href="#takeaways-1"><span class="header-section-number">18.1.3</span> Takeaways</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#multi-site-trials"><span class="header-section-number">18.2</span> Multi-site trials</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#bayesian-estimation-can-improve-estimates-of-effects-for-sampled-sites"><span class="header-section-number">18.2.1</span> Bayesian estimation can improve estimates of effects for sampled sites</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="download-code" href="./multi-study-designs.R"><i class="far fa-file-code"></i> Download R code</a></li>
          
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Research Design: Declare, Diagnose, Redesign</strong>" was written by Graeme Blair, Alexander Coppock, and Macartan Humphreys. </p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
