<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>16.6 Synthetic controls | Research Design: Declare, Diagnose, Redesign</title>
  <meta name="description" content="describe the book" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="16.6 Synthetic controls | Research Design: Declare, Diagnose, Redesign" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="describe the book" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="16.6 Synthetic controls | Research Design: Declare, Diagnose, Redesign" />
  
  <meta name="twitter:description" content="describe the book" />
  

<meta name="author" content="Graeme Blair, Jasper Cooper, Alexander Coppock, and Macartan Humphreys" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="process-tracing.html"/>
<link rel="next" href="policing-and-post-treatment-bias.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="https://hypothes.is/embed.js" async></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="headers/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><b>Research Design</b></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="preamble.html"><a href="preamble.html"><i class="fa fa-check"></i><b>1</b> Preamble</a></li>
<li class="chapter" data-level="2" data-path="improving-research-designs.html"><a href="improving-research-designs.html"><i class="fa fa-check"></i><b>2</b> Improving research designs</a><ul>
<li class="chapter" data-level="2.1" data-path="design-declaration-model-inquiry-data-strategy-answer-strategy.html"><a href="design-declaration-model-inquiry-data-strategy-answer-strategy.html"><i class="fa fa-check"></i><b>2.1</b> Design Declaration: Model-Inquiry-Data Strategy-Answer Strategy</a><ul>
<li class="chapter" data-level="2.1.1" data-path="design-declaration-model-inquiry-data-strategy-answer-strategy.html"><a href="design-declaration-model-inquiry-data-strategy-answer-strategy.html#example-gulzar2020"><i class="fa fa-check"></i><b>2.1.1</b> Example: <span class="citation">Gulzar and Khan (<span>n.d.</span>)</span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="assessing-research-design-quality-design-diagnosis.html"><a href="assessing-research-design-quality-design-diagnosis.html"><i class="fa fa-check"></i><b>2.2</b> Assessing research design quality: design diagnosis</a></li>
<li class="chapter" data-level="2.3" data-path="redesign.html"><a href="redesign.html"><i class="fa fa-check"></i><b>2.3</b> Redesign</a></li>
<li class="chapter" data-level="2.4" data-path="formalizing-design-declaration-diagnosis-and-redesing-.html"><a href="formalizing-design-declaration-diagnosis-and-redesing-.html"><i class="fa fa-check"></i><b>2.4</b> Formalizing design declaration, diagnosis, and redesing.</a><ul>
<li class="chapter" data-level="2.4.1" data-path="formalizing-design-declaration-diagnosis-and-redesing-.html"><a href="formalizing-design-declaration-diagnosis-and-redesing-.html#formalizing-mida"><i class="fa fa-check"></i><b>2.4.1</b> Formalizing MIDA</a></li>
<li class="chapter" data-level="2.4.2" data-path="formalizing-design-declaration-diagnosis-and-redesing-.html"><a href="formalizing-design-declaration-diagnosis-and-redesing-.html#formalizing-diagnosis"><i class="fa fa-check"></i><b>2.4.2</b> Formalizing Diagnosis</a></li>
<li class="chapter" data-level="2.4.3" data-path="formalizing-design-declaration-diagnosis-and-redesing-.html"><a href="formalizing-design-declaration-diagnosis-and-redesing-.html#formalizing-redesign"><i class="fa fa-check"></i><b>2.4.3</b> Formalizing Redesign</a></li>
<li class="chapter" data-level="2.4.4" data-path="formalizing-design-declaration-diagnosis-and-redesing-.html"><a href="formalizing-design-declaration-diagnosis-and-redesing-.html#brief-illustration"><i class="fa fa-check"></i><b>2.4.4</b> Brief Illustration</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="relationship-to-other-ways-of-thinking-about-research-design.html"><a href="relationship-to-other-ways-of-thinking-about-research-design.html"><i class="fa fa-check"></i><b>2.5</b> Relationship to other ways of thinking about research design</a></li>
<li class="chapter" data-level="2.6" data-path="putting-designs-to-use.html"><a href="putting-designs-to-use.html"><i class="fa fa-check"></i><b>2.6</b> Putting designs to use</a></li>
<li class="chapter" data-level="2.7" data-path="avoiding-declaration-and-diagnosis-pitfalls.html"><a href="avoiding-declaration-and-diagnosis-pitfalls.html"><i class="fa fa-check"></i><b>2.7</b> Avoiding declaration and diagnosis pitfalls</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="software-primer.html"><a href="software-primer.html"><i class="fa fa-check"></i><b>3</b> Software primer</a><ul>
<li class="chapter" data-level="3.1" data-path="installing-r.html"><a href="installing-r.html"><i class="fa fa-check"></i><b>3.1</b> Installing R</a></li>
<li class="chapter" data-level="3.2" data-path="where-we-are-going.html"><a href="where-we-are-going.html"><i class="fa fa-check"></i><b>3.2</b> Where we are going</a><ul>
<li class="chapter" data-level="3.2.1" data-path="where-we-are-going.html"><a href="where-we-are-going.html#declaring-a-design"><i class="fa fa-check"></i><b>3.2.1</b> Declaring a design</a></li>
<li class="chapter" data-level="3.2.2" data-path="where-we-are-going.html"><a href="where-we-are-going.html#diagnosis"><i class="fa fa-check"></i><b>3.2.2</b> Diagnosis</a></li>
<li class="chapter" data-level="3.2.3" data-path="where-we-are-going.html"><a href="where-we-are-going.html#redesign-1"><i class="fa fa-check"></i><b>3.2.3</b> Redesign</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="building-a-step-of-a-research-design.html"><a href="building-a-step-of-a-research-design.html"><i class="fa fa-check"></i><b>3.3</b> Building a step of a research design</a><ul>
<li class="chapter" data-level="3.3.1" data-path="building-a-step-of-a-research-design.html"><a href="building-a-step-of-a-research-design.html#using-dplyr"><i class="fa fa-check"></i><b>3.3.1</b> Using dplyr</a></li>
<li class="chapter" data-level="3.3.2" data-path="building-a-step-of-a-research-design.html"><a href="building-a-step-of-a-research-design.html#as-a-function"><i class="fa fa-check"></i><b>3.3.2</b> As a function</a></li>
<li class="chapter" data-level="3.3.3" data-path="building-a-step-of-a-research-design.html"><a href="building-a-step-of-a-research-design.html#in-declaredesign"><i class="fa fa-check"></i><b>3.3.3</b> In DeclareDesign</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="research-design-steps.html"><a href="research-design-steps.html"><i class="fa fa-check"></i><b>3.4</b> Research design steps</a><ul>
<li class="chapter" data-level="3.4.1" data-path="research-design-steps.html"><a href="research-design-steps.html#model"><i class="fa fa-check"></i><b>3.4.1</b> Model</a></li>
<li class="chapter" data-level="3.4.2" data-path="research-design-steps.html"><a href="research-design-steps.html#inquiry"><i class="fa fa-check"></i><b>3.4.2</b> Inquiry</a></li>
<li class="chapter" data-level="3.4.3" data-path="research-design-steps.html"><a href="research-design-steps.html#data-strategy"><i class="fa fa-check"></i><b>3.4.3</b> Data strategy</a></li>
<li class="chapter" data-level="3.4.4" data-path="research-design-steps.html"><a href="research-design-steps.html#answer-strategy"><i class="fa fa-check"></i><b>3.4.4</b> Answer strategy</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="building-a-design-from-design-steps.html"><a href="building-a-design-from-design-steps.html"><i class="fa fa-check"></i><b>3.5</b> Building a design from design steps</a><ul>
<li class="chapter" data-level="3.5.1" data-path="building-a-design-from-design-steps.html"><a href="building-a-design-from-design-steps.html#order-matters"><i class="fa fa-check"></i><b>3.5.1</b> Order matters</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="simulating-a-research-design.html"><a href="simulating-a-research-design.html"><i class="fa fa-check"></i><b>3.6</b> Simulating a research design</a><ul>
<li class="chapter" data-level="3.6.1" data-path="simulating-a-research-design.html"><a href="simulating-a-research-design.html#in-dplyr"><i class="fa fa-check"></i><b>3.6.1</b> In <code>dplyr</code></a></li>
<li class="chapter" data-level="3.6.2" data-path="simulating-a-research-design.html"><a href="simulating-a-research-design.html#in-declaredesign-1"><i class="fa fa-check"></i><b>3.6.2</b> In <code>DeclareDesign</code></a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="diagnosing-a-research-design.html"><a href="diagnosing-a-research-design.html"><i class="fa fa-check"></i><b>3.7</b> Diagnosing a research design</a></li>
<li class="chapter" data-level="3.8" data-path="comparing-designs.html"><a href="comparing-designs.html"><i class="fa fa-check"></i><b>3.8</b> Comparing designs</a><ul>
<li class="chapter" data-level="3.8.1" data-path="comparing-designs.html"><a href="comparing-designs.html#comparing-many-variants-of-a-design"><i class="fa fa-check"></i><b>3.8.1</b> Comparing many variants of a design</a></li>
<li class="chapter" data-level="3.8.2" data-path="comparing-designs.html"><a href="comparing-designs.html#library-of-designs"><i class="fa fa-check"></i><b>3.8.2</b> Library of designs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html"><i class="fa fa-check"></i><b>4</b> How to use this book</a></li>
<li class="chapter" data-level="5" data-path="part-i-exercises.html"><a href="part-i-exercises.html"><i class="fa fa-check"></i><b>5</b> Part I Exercises</a></li>
<li class="part"><span><b>II Declaration and Diagnosis in Practice</b></span></li>
<li class="chapter" data-level="6" data-path="the-fundamental-2x2-of-research-design.html"><a href="the-fundamental-2x2-of-research-design.html"><i class="fa fa-check"></i><b>6</b> The Fundamental 2x2 of Research Design</a></li>
<li class="chapter" data-level="7" data-path="specifying-the-model.html"><a href="specifying-the-model.html"><i class="fa fa-check"></i><b>7</b> Specifying the model</a><ul>
<li class="chapter" data-level="7.1" data-path="two-languages-for-describing-causal-models.html"><a href="two-languages-for-describing-causal-models.html"><i class="fa fa-check"></i><b>7.1</b> Two languages for describing causal models</a><ul>
<li class="chapter" data-level="7.1.1" data-path="two-languages-for-describing-causal-models.html"><a href="two-languages-for-describing-causal-models.html#dags"><i class="fa fa-check"></i><b>7.1.1</b> DAGs</a></li>
<li class="chapter" data-level="7.1.2" data-path="two-languages-for-describing-causal-models.html"><a href="two-languages-for-describing-causal-models.html#potential-outcomes-1"><i class="fa fa-check"></i><b>7.1.2</b> Potential outcomes</a></li>
<li class="chapter" data-level="7.1.3" data-path="two-languages-for-describing-causal-models.html"><a href="two-languages-for-describing-causal-models.html#complementary-strengths-of-dags-and-potential-outcomes"><i class="fa fa-check"></i><b>7.1.3</b> Complementary strengths of DAGs and potential outcomes</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="example-ambrus2020loss.html"><a href="example-ambrus2020loss.html"><i class="fa fa-check"></i><b>7.2</b> Example: <span class="citation">Ambrus, Field, and Gonzalez (<span>2020</span>)</span></a></li>
<li class="chapter" data-level="7.3" data-path="elements-of-the-model.html"><a href="elements-of-the-model.html"><i class="fa fa-check"></i><b>7.3</b> Elements of the model</a><ul>
<li class="chapter" data-level="7.3.1" data-path="elements-of-the-model.html"><a href="elements-of-the-model.html#exogenous-variables"><i class="fa fa-check"></i><b>7.3.1</b> Exogenous variables</a></li>
<li class="chapter" data-level="7.3.2" data-path="elements-of-the-model.html"><a href="elements-of-the-model.html#endogenous-variables"><i class="fa fa-check"></i><b>7.3.2</b> Endogenous variables</a></li>
<li class="chapter" data-level="7.3.3" data-path="elements-of-the-model.html"><a href="elements-of-the-model.html#when-you-do-and-do-not-need-to-define-potential-outcomes"><i class="fa fa-check"></i><b>7.3.3</b> When you do and do not need to define potential outcomes</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="grab-bag-of-ideas-that-dont-yet-have-a-home.html"><a href="grab-bag-of-ideas-that-dont-yet-have-a-home.html"><i class="fa fa-check"></i><b>7.4</b> Grab bag of ideas that don’t yet have a home</a><ul>
<li class="chapter" data-level="7.4.1" data-path="grab-bag-of-ideas-that-dont-yet-have-a-home.html"><a href="grab-bag-of-ideas-that-dont-yet-have-a-home.html#what-to-do-when-you-are-uncertain"><i class="fa fa-check"></i><b>7.4.1</b> What to do when you are uncertain</a></li>
<li class="chapter" data-level="7.4.2" data-path="grab-bag-of-ideas-that-dont-yet-have-a-home.html"><a href="grab-bag-of-ideas-that-dont-yet-have-a-home.html#how-you-already-specify-models-in-everyday-research"><i class="fa fa-check"></i><b>7.4.2</b> How you already specify models in everyday research</a></li>
<li class="chapter" data-level="7.4.3" data-path="grab-bag-of-ideas-that-dont-yet-have-a-home.html"><a href="grab-bag-of-ideas-that-dont-yet-have-a-home.html#last-word-on-models"><i class="fa fa-check"></i><b>7.4.3</b> Last word on models</a></li>
<li class="chapter" data-level="7.4.4" data-path="grab-bag-of-ideas-that-dont-yet-have-a-home.html"><a href="grab-bag-of-ideas-that-dont-yet-have-a-home.html#selecting-models"><i class="fa fa-check"></i><b>7.4.4</b> Selecting models</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="kinds-of-inquiries.html"><a href="kinds-of-inquiries.html"><i class="fa fa-check"></i><b>7.5</b> Kinds of Inquiries</a><ul>
<li class="chapter" data-level="7.5.1" data-path="kinds-of-inquiries.html"><a href="kinds-of-inquiries.html#descriptive-estimands"><i class="fa fa-check"></i><b>7.5.1</b> Descriptive estimands</a></li>
<li class="chapter" data-level="7.5.2" data-path="kinds-of-inquiries.html"><a href="kinds-of-inquiries.html#causal-inquires"><i class="fa fa-check"></i><b>7.5.2</b> Causal Inquires</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="how-should-you-select-inquiries.html"><a href="how-should-you-select-inquiries.html"><i class="fa fa-check"></i><b>7.6</b> How should you select Inquiries?</a></li>
<li class="chapter" data-level="7.7" data-path="grab-bag-of-ideas-we-dont-know-where-to-put.html"><a href="grab-bag-of-ideas-we-dont-know-where-to-put.html"><i class="fa fa-check"></i><b>7.7</b> Grab bag of ideas we don’t know where to put</a><ul>
<li class="chapter" data-level="7.7.1" data-path="grab-bag-of-ideas-we-dont-know-where-to-put.html"><a href="grab-bag-of-ideas-we-dont-know-where-to-put.html#advice-section"><i class="fa fa-check"></i><b>7.7.1</b> ADVICE SECTION</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="crafting-a-data-strategy.html"><a href="crafting-a-data-strategy.html"><i class="fa fa-check"></i><b>8</b> Crafting a data strategy</a><ul>
<li class="chapter" data-level="8.1" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>8.1</b> Example</a></li>
<li class="chapter" data-level="8.2" data-path="elements-of-a-data-strategy.html"><a href="elements-of-a-data-strategy.html"><i class="fa fa-check"></i><b>8.2</b> Elements of a data strategy</a><ul>
<li class="chapter" data-level="8.2.1" data-path="elements-of-a-data-strategy.html"><a href="elements-of-a-data-strategy.html#sampling-1"><i class="fa fa-check"></i><b>8.2.1</b> Sampling</a></li>
<li class="chapter" data-level="8.2.2" data-path="elements-of-a-data-strategy.html"><a href="elements-of-a-data-strategy.html#treatment-assignment"><i class="fa fa-check"></i><b>8.2.2</b> Treatment assignment</a></li>
<li class="chapter" data-level="8.2.3" data-path="elements-of-a-data-strategy.html"><a href="elements-of-a-data-strategy.html#measurement"><i class="fa fa-check"></i><b>8.2.3</b> Measurement</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="grab-bag.html"><a href="grab-bag.html"><i class="fa fa-check"></i><b>8.3</b> Grab bag</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="choosing-an-answer-strategy.html"><a href="choosing-an-answer-strategy.html"><i class="fa fa-check"></i><b>9</b> Choosing an answer strategy</a><ul>
<li class="chapter" data-level="9.1" data-path="example-1.html"><a href="example-1.html"><i class="fa fa-check"></i><b>9.1</b> Example</a></li>
<li class="chapter" data-level="9.2" data-path="in-declaredesign-2.html"><a href="in-declaredesign-2.html"><i class="fa fa-check"></i><b>9.2</b> In DeclareDesign</a></li>
<li class="chapter" data-level="9.3" data-path="connections-to-mida.html"><a href="connections-to-mida.html"><i class="fa fa-check"></i><b>9.3</b> Connections to MIDA</a></li>
<li class="chapter" data-level="9.4" data-path="how-you-already-choose-answer-strategies-in-current-practice.html"><a href="how-you-already-choose-answer-strategies-in-current-practice.html"><i class="fa fa-check"></i><b>9.4</b> How you already choose answer strategies in current practice</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="diagnosis-1.html"><a href="diagnosis-1.html"><i class="fa fa-check"></i><b>10</b> Diagnosis</a><ul>
<li class="chapter" data-level="10.1" data-path="diagnosing-a-design.html"><a href="diagnosing-a-design.html"><i class="fa fa-check"></i><b>10.1</b> Diagnosing a design</a></li>
<li class="chapter" data-level="10.2" data-path="estimating-diagnosands-analytically.html"><a href="estimating-diagnosands-analytically.html"><i class="fa fa-check"></i><b>10.2</b> Estimating diagnosands analytically</a></li>
<li class="chapter" data-level="10.3" data-path="estimating-diagnosands-via-simulation.html"><a href="estimating-diagnosands-via-simulation.html"><i class="fa fa-check"></i><b>10.3</b> Estimating diagnosands via simulation</a></li>
<li class="chapter" data-level="10.4" data-path="four-large-classes-of-diagnosands.html"><a href="four-large-classes-of-diagnosands.html"><i class="fa fa-check"></i><b>10.4</b> Four large classes of diagnosands:</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="redesign-2.html"><a href="redesign-2.html"><i class="fa fa-check"></i><b>11</b> Redesign</a><ul>
<li class="chapter" data-level="11.1" data-path="redesign-to-assess-the-robustness-of-designs-to-models-gb.html"><a href="redesign-to-assess-the-robustness-of-designs-to-models-gb.html"><i class="fa fa-check"></i><b>11.1</b> Redesign to assess the robustness of designs to models [GB]</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="part-ii-exercises.html"><a href="part-ii-exercises.html"><i class="fa fa-check"></i><b>12</b> Part II Exercises</a></li>
<li class="part"><span><b>III Design Library</b></span></li>
<li class="chapter" data-level="13" data-path="design-library.html"><a href="design-library.html"><i class="fa fa-check"></i><b>13</b> Design Library</a></li>
<li class="chapter" data-level="14" data-path="observational-designs-for-descriptive-inference.html"><a href="observational-designs-for-descriptive-inference.html"><i class="fa fa-check"></i><b>14</b> Observational designs for descriptive inference</a><ul>
<li class="chapter" data-level="14.1" data-path="random-sampling.html"><a href="random-sampling.html"><i class="fa fa-check"></i><b>14.1</b> Random sampling</a><ul>
<li class="chapter" data-level="14.1.1" data-path="random-sampling.html"><a href="random-sampling.html#simple-random-sampling"><i class="fa fa-check"></i><b>14.1.1</b> Simple random sampling</a></li>
<li class="chapter" data-level="14.1.2" data-path="random-sampling.html"><a href="random-sampling.html#stratified-and-clustered-random-sampling"><i class="fa fa-check"></i><b>14.1.2</b> Stratified and clustered random sampling</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="multilevel-regression-and-poststratification.html"><a href="multilevel-regression-and-poststratification.html"><i class="fa fa-check"></i><b>14.2</b> Multilevel regression and poststratification</a></li>
<li class="chapter" data-level="14.3" data-path="inference-about-unobserved-variables.html"><a href="inference-about-unobserved-variables.html"><i class="fa fa-check"></i><b>14.3</b> Inference about unobserved variables</a></li>
<li class="chapter" data-level="14.4" data-path="structural-estimation.html"><a href="structural-estimation.html"><i class="fa fa-check"></i><b>14.4</b> Structural estimation</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="experimental-designs-for-descriptive-inference.html"><a href="experimental-designs-for-descriptive-inference.html"><i class="fa fa-check"></i><b>15</b> Experimental designs for descriptive inference</a><ul>
<li class="chapter" data-level="15.1" data-path="audit-experiments.html"><a href="audit-experiments.html"><i class="fa fa-check"></i><b>15.1</b> Audit experiments</a><ul>
<li class="chapter" data-level="15.1.1" data-path="audit-experiments.html"><a href="audit-experiments.html#design-declaration-2"><i class="fa fa-check"></i><b>15.1.1</b> Design Declaration</a></li>
<li class="chapter" data-level="15.1.2" data-path="audit-experiments.html"><a href="audit-experiments.html#takeaways-2"><i class="fa fa-check"></i><b>15.1.2</b> Takeaways</a></li>
<li class="chapter" data-level="15.1.3" data-path="audit-experiments.html"><a href="audit-experiments.html#applications"><i class="fa fa-check"></i><b>15.1.3</b> Applications</a></li>
<li class="chapter" data-level="15.1.4" data-path="audit-experiments.html"><a href="audit-experiments.html#exercises-1"><i class="fa fa-check"></i><b>15.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="experiments-for-sensitive-questions.html"><a href="experiments-for-sensitive-questions.html"><i class="fa fa-check"></i><b>15.2</b> Experiments for sensitive questions</a><ul>
<li class="chapter" data-level="15.2.1" data-path="experiments-for-sensitive-questions.html"><a href="experiments-for-sensitive-questions.html#list-experiments"><i class="fa fa-check"></i><b>15.2.1</b> List experiments</a></li>
<li class="chapter" data-level="15.2.2" data-path="experiments-for-sensitive-questions.html"><a href="experiments-for-sensitive-questions.html#randomized-response-technique"><i class="fa fa-check"></i><b>15.2.2</b> Randomized response technique</a></li>
<li class="chapter" data-level="15.2.3" data-path="experiments-for-sensitive-questions.html"><a href="experiments-for-sensitive-questions.html#references"><i class="fa fa-check"></i><b>15.2.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="conjoint-experimetns.html"><a href="conjoint-experimetns.html"><i class="fa fa-check"></i><b>15.3</b> Conjoint experimetns</a></li>
<li class="chapter" data-level="15.4" data-path="behavioral-games.html"><a href="behavioral-games.html"><i class="fa fa-check"></i><b>15.4</b> Behavioral games</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="observational-designs-for-causal-inference.html"><a href="observational-designs-for-causal-inference.html"><i class="fa fa-check"></i><b>16</b> Observational designs for causal inference</a><ul>
<li class="chapter" data-level="16.1" data-path="selection-on-observables.html"><a href="selection-on-observables.html"><i class="fa fa-check"></i><b>16.1</b> Selection on observables</a><ul>
<li class="chapter" data-level="16.1.1" data-path="selection-on-observables.html"><a href="selection-on-observables.html#classic-confounding"><i class="fa fa-check"></i><b>16.1.1</b> Classic Confounding</a></li>
<li class="chapter" data-level="16.1.2" data-path="selection-on-observables.html"><a href="selection-on-observables.html#what-if-the-functional-form-is-wrong"><i class="fa fa-check"></i><b>16.1.2</b> What if the functional form is wrong?</a></li>
<li class="chapter" data-level="16.1.3" data-path="selection-on-observables.html"><a href="selection-on-observables.html#what-if-you-have-unobserved-confounding"><i class="fa fa-check"></i><b>16.1.3</b> What if you have unobserved confounding?</a></li>
<li class="chapter" data-level="16.1.4" data-path="selection-on-observables.html"><a href="selection-on-observables.html#what-if-the-observed-covariate-is-post-treatment"><i class="fa fa-check"></i><b>16.1.4</b> What if the observed covariate is post-treatment?</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>16.2</b> Instrumental variables</a></li>
<li class="chapter" data-level="16.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>16.3</b> Difference-in-differences</a><ul>
<li class="chapter" data-level="16.3.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#two-period-two-group-setting"><i class="fa fa-check"></i><b>16.3.1</b> Two-period two-group setting</a></li>
<li class="chapter" data-level="16.3.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#parallel-trends-assumption"><i class="fa fa-check"></i><b>16.3.2</b> Parallel trends assumption</a></li>
<li class="chapter" data-level="16.3.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html#multi-period-design"><i class="fa fa-check"></i><b>16.3.3</b> Multi-period design</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html"><i class="fa fa-check"></i><b>16.4</b> Regression Discontinuity</a><ul>
<li class="chapter" data-level="16.4.1" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#design-declaration-3"><i class="fa fa-check"></i><b>16.4.1</b> Design Declaration</a></li>
<li class="chapter" data-level="16.4.2" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#takeaways-3"><i class="fa fa-check"></i><b>16.4.2</b> Takeaways</a></li>
<li class="chapter" data-level="16.4.3" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#further-reading"><i class="fa fa-check"></i><b>16.4.3</b> Further Reading</a></li>
<li class="chapter" data-level="16.4.4" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#exercises-2"><i class="fa fa-check"></i><b>16.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="process-tracing.html"><a href="process-tracing.html"><i class="fa fa-check"></i><b>16.5</b> Process tracing</a></li>
<li class="chapter" data-level="16.6" data-path="synthetic-controls.html"><a href="synthetic-controls.html"><i class="fa fa-check"></i><b>16.6</b> Synthetic controls</a><ul>
<li class="chapter" data-level="16.6.1" data-path="synthetic-controls.html"><a href="synthetic-controls.html#when-there-are-not-good-controls-standard-synth-will-get-the-wrong-answer"><i class="fa fa-check"></i><b>16.6.1</b> When there are not good controls, standard synth will get the wrong answer</a></li>
<li class="chapter" data-level="16.6.2" data-path="synthetic-controls.html"><a href="synthetic-controls.html#references-1"><i class="fa fa-check"></i><b>16.6.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="policing-and-post-treatment-bias.html"><a href="policing-and-post-treatment-bias.html"><i class="fa fa-check"></i><b>16.7</b> Policing and post-treatment bias</a></li>
<li class="chapter" data-level="16.8" data-path="design-declaration-4.html"><a href="design-declaration-4.html"><i class="fa fa-check"></i><b>16.8</b> Design Declaration</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="experimental-designs-for-causal-inference.html"><a href="experimental-designs-for-causal-inference.html"><i class="fa fa-check"></i><b>17</b> Experimental designs for causal inference</a><ul>
<li class="chapter" data-level="17.1" data-path="two-arm-trials.html"><a href="two-arm-trials.html"><i class="fa fa-check"></i><b>17.1</b> Two arm trials</a></li>
<li class="chapter" data-level="17.2" data-path="two-arm-trials-and-designs-with-blocking-and-clustering.html"><a href="two-arm-trials-and-designs-with-blocking-and-clustering.html"><i class="fa fa-check"></i><b>17.2</b> Two-arm trials and designs with blocking and clustering</a></li>
<li class="chapter" data-level="17.3" data-path="multiarm-designs.html"><a href="multiarm-designs.html"><i class="fa fa-check"></i><b>17.3</b> Multiarm Designs</a></li>
<li class="chapter" data-level="17.4" data-path="encouragement-designs.html"><a href="encouragement-designs.html"><i class="fa fa-check"></i><b>17.4</b> Encouragement designs</a><ul>
<li class="chapter" data-level="17.4.1" data-path="encouragement-designs.html"><a href="encouragement-designs.html#references-2"><i class="fa fa-check"></i><b>17.4.1</b> References</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="stepped-wedge-designs.html"><a href="stepped-wedge-designs.html"><i class="fa fa-check"></i><b>17.5</b> Stepped wedge designs</a><ul>
<li class="chapter" data-level="17.5.1" data-path="stepped-wedge-designs.html"><a href="stepped-wedge-designs.html#design-declaration-5"><i class="fa fa-check"></i><b>17.5.1</b> Design Declaration</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="spillovers.html"><a href="spillovers.html"><i class="fa fa-check"></i><b>17.6</b> Spillovers</a><ul>
<li class="chapter" data-level="17.6.1" data-path="spillovers.html"><a href="spillovers.html#references-3"><i class="fa fa-check"></i><b>17.6.1</b> References</a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="randomized-saturation-design.html"><a href="randomized-saturation-design.html"><i class="fa fa-check"></i><b>17.7</b> Randomized Saturation Design</a><ul>
<li class="chapter" data-level="17.7.1" data-path="randomized-saturation-design.html"><a href="randomized-saturation-design.html#design-declaration-6"><i class="fa fa-check"></i><b>17.7.1</b> Design Declaration</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="multi-study-designs.html"><a href="multi-study-designs.html"><i class="fa fa-check"></i><b>18</b> Multi-study designs</a><ul>
<li class="chapter" data-level="18.1" data-path="papers-with-multiple-studies.html"><a href="papers-with-multiple-studies.html"><i class="fa fa-check"></i><b>18.1</b> Papers with multiple studies</a><ul>
<li class="chapter" data-level="18.1.1" data-path="papers-with-multiple-studies.html"><a href="papers-with-multiple-studies.html#design-declaration-7"><i class="fa fa-check"></i><b>18.1.1</b> Design Declaration</a></li>
<li class="chapter" data-level="18.1.2" data-path="papers-with-multiple-studies.html"><a href="papers-with-multiple-studies.html#takeaways-4"><i class="fa fa-check"></i><b>18.1.2</b> Takeaways</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="multi-site-studies.html"><a href="multi-site-studies.html"><i class="fa fa-check"></i><b>18.2</b> Multi-site studies</a></li>
<li class="chapter" data-level="18.3" data-path="the-metaketa-design.html"><a href="the-metaketa-design.html"><i class="fa fa-check"></i><b>18.3</b> The Metaketa design</a><ul>
<li class="chapter" data-level="18.3.1" data-path="the-metaketa-design.html"><a href="the-metaketa-design.html#unbiased-estimates-of-out-of-sample-sites-in-presence-of-heterogeneous-effects"><i class="fa fa-check"></i><b>18.3.1</b> Unbiased estimates of out-of-sample sites in presence of heterogeneous effects</a></li>
<li class="chapter" data-level="18.3.2" data-path="the-metaketa-design.html"><a href="the-metaketa-design.html#bayesian-estimation-can-improve-estimates-of-effects-for-sampled-sites"><i class="fa fa-check"></i><b>18.3.2</b> Bayesian estimation can improve estimates of effects for sampled sites</a></li>
<li class="chapter" data-level="18.3.3" data-path="the-metaketa-design.html"><a href="the-metaketa-design.html#when-things-break-down-confounded-sampling"><i class="fa fa-check"></i><b>18.3.3</b> when things break down: confounded sampling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="part-iii-exercises.html"><a href="part-iii-exercises.html"><i class="fa fa-check"></i><b>19</b> Part III Exercises</a></li>
<li class="part"><span><b>IV Conclusion</b></span></li>
<li class="chapter" data-level="20" data-path="putting-designs-to-use-1.html"><a href="putting-designs-to-use-1.html"><i class="fa fa-check"></i><b>20</b> Putting Designs to Use</a><ul>
<li class="chapter" data-level="20.1" data-path="before-studies.html"><a href="before-studies.html"><i class="fa fa-check"></i><b>20.1</b> Before studies</a><ul>
<li class="chapter" data-level="20.1.1" data-path="before-studies.html"><a href="before-studies.html#pre-analysis-plans"><i class="fa fa-check"></i><b>20.1.1</b> Pre-Analysis Plans</a></li>
<li class="chapter" data-level="20.1.2" data-path="before-studies.html"><a href="before-studies.html#registered-reports"><i class="fa fa-check"></i><b>20.1.2</b> Registered Reports</a></li>
<li class="chapter" data-level="20.1.3" data-path="before-studies.html"><a href="before-studies.html#standard-operating-procedures"><i class="fa fa-check"></i><b>20.1.3</b> Standard Operating Procedures</a></li>
<li class="chapter" data-level="20.1.4" data-path="before-studies.html"><a href="before-studies.html#evaluating-and-supporting-research"><i class="fa fa-check"></i><b>20.1.4</b> Evaluating and Supporting Research</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="after-studies.html"><a href="after-studies.html"><i class="fa fa-check"></i><b>20.2</b> After studies</a><ul>
<li class="chapter" data-level="20.2.1" data-path="after-studies.html"><a href="after-studies.html#reconciliation"><i class="fa fa-check"></i><b>20.2.1</b> Reconciliation</a></li>
<li class="chapter" data-level="20.2.2" data-path="after-studies.html"><a href="after-studies.html#replication"><i class="fa fa-check"></i><b>20.2.2</b> Replication</a></li>
<li class="chapter" data-level="20.2.3" data-path="after-studies.html"><a href="after-studies.html#peers-better-scholarly-critique"><i class="fa fa-check"></i><b>20.2.3</b> Peers: Better scholarly critique</a></li>
<li class="chapter" data-level="20.2.4" data-path="after-studies.html"><a href="after-studies.html#combining-designs"><i class="fa fa-check"></i><b>20.2.4</b> Combining designs</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="improving-designs-in-the-social-sciences.html"><a href="improving-designs-in-the-social-sciences.html"><i class="fa fa-check"></i><b>20.3</b> Improving designs in the social sciences</a><ul>
<li class="chapter" data-level="20.3.1" data-path="improving-designs-in-the-social-sciences.html"><a href="improving-designs-in-the-social-sciences.html#a-library-of-research-designs-as-objects"><i class="fa fa-check"></i><b>20.3.1</b> A library of research designs as objects</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="part-iv-exercises.html"><a href="part-iv-exercises.html"><i class="fa fa-check"></i><b>20.4</b> Part IV Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-4.html"><a href="references-4.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://declaredesign.org" target="blank">DeclareDesign</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Research Design: Declare, Diagnose, Redesign</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="synthetic-controls" class="section level2">
<h2><span class="header-section-number">16.6</span> Synthetic controls</h2>
<!-- make sure to rename the section title below -->
<p>Modeled after the example here:</p>
<p><a href="https://www.mitpressjournals.org/doi/abs/10.1162/REST_a_00429?casa_token=o-zWqCima50AAAAA:yiEERZfdhAUoHV0-xBYNjgdljvgfRXrriR8foG7X8nHSUAMFrLcw2vWY8e9pHzmRT24MMAIv9hvKpQ" class="uri">https://www.mitpressjournals.org/doi/abs/10.1162/REST_a_00429?casa_token=o-zWqCima50AAAAA:yiEERZfdhAUoHV0-xBYNjgdljvgfRXrriR8foG7X8nHSUAMFrLcw2vWY8e9pHzmRT24MMAIv9hvKpQ</a></p>
<p>Did the 2007 Legal Arizona Workers Act Reduce the State’s Unauthorized Immigrant Population?
Sarah Bohn, Magnus Lofstrom, and Steven Raphael
The Review of Economics and Statistics 2014 96:2, 258-269
Abstract: We test for an effect of Arizona’s 2007 Legal Arizona Workers Act (LAWA) on the proportion of the state’s population characterized as noncitizen Hispanic. We use the synthetic control method to select a group of states against which Arizona’s population trends can be compared. We document a notable and statistically significant reduction in the proportion of the Hispanic noncitizen population in Arizona. The decline observed matches the timing of LAWA’s implementation, deviates from the time series for the synthetic control group, and stands out relative to the distribution of placebo estimates for other states in the nation.</p>
<p>Outline:
(1) how does synth work?
- declaration: set up states with time trends and levels that are both correlated with a type and following the linear model assumed by SCM
- try three estimators: (1) difference-in-difference; (2) single difference in treated period; and (3) difference in treated period weighted by Synth weights.
- show that synth works under its assumptions; plot of time series of treat and synthetic control; plot of the time series from all units to illustrate which are picked (sorted by weights)
(2) what are synth’s assumptions?
- linear model; treated unit is in convex hull of control units’ pretreatment time series
(3) how to diagnose when you are outside the convex hull
- declaration outside the convex hull and use the Abadie diagnostic demonstrating a poor match. (possibly explore power of this diagnostic)
- show that synth is biased in this setting. augsynth is not.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1"><span class="co"># tidy function that takes data and just adds the synthetic control weights to it</span></a>
<a class="sourceLine" id="cb120-2" title="2">synth_weights_tidy &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb120-3" title="3">  dataprep.out &lt;-<span class="st"> </span><span class="kw">dataprep</span>(</a>
<a class="sourceLine" id="cb120-4" title="4">    <span class="dt">foo =</span> data,</a>
<a class="sourceLine" id="cb120-5" title="5">    <span class="dt">predictors =</span> <span class="st">&quot;prop_non_hispanic_below_hs&quot;</span>,</a>
<a class="sourceLine" id="cb120-6" title="6">    <span class="dt">predictors.op =</span> <span class="st">&quot;mean&quot;</span>,</a>
<a class="sourceLine" id="cb120-7" title="7">    <span class="dt">time.predictors.prior =</span> <span class="dv">1998</span><span class="op">:</span><span class="dv">2006</span>,</a>
<a class="sourceLine" id="cb120-8" title="8">    <span class="dt">dependent =</span> <span class="st">&quot;prop_non_hispanic_below_hs&quot;</span>,</a>
<a class="sourceLine" id="cb120-9" title="9">    <span class="dt">unit.variable =</span> <span class="st">&quot;state_number&quot;</span>,</a>
<a class="sourceLine" id="cb120-10" title="10">    <span class="dt">time.variable =</span> <span class="st">&quot;year&quot;</span>,</a>
<a class="sourceLine" id="cb120-11" title="11">    <span class="dt">treatment.identifier =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb120-12" title="12">    <span class="dt">controls.identifier =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">50</span>), <span class="co"># states without Arizona</span></a>
<a class="sourceLine" id="cb120-13" title="13">    <span class="dt">time.optimize.ssr =</span> <span class="dv">1998</span><span class="op">:</span><span class="dv">2006</span>,</a>
<a class="sourceLine" id="cb120-14" title="14">    <span class="dt">time.plot =</span> <span class="dv">1998</span><span class="op">:</span><span class="dv">2009</span>)</a>
<a class="sourceLine" id="cb120-15" title="15">  <span class="kw">capture.output</span>(fit &lt;-<span class="st"> </span><span class="kw">synth</span>(<span class="dt">data.prep.obj =</span> dataprep.out))</a>
<a class="sourceLine" id="cb120-16" title="16">  tab &lt;-<span class="st"> </span><span class="kw">synth.tab</span>(<span class="dt">dataprep.res =</span> dataprep.out, <span class="dt">synth.res =</span> fit) </a>
<a class="sourceLine" id="cb120-17" title="17">  </a>
<a class="sourceLine" id="cb120-18" title="18">  data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb120-19" title="19"><span class="st">    </span><span class="kw">left_join</span>(tab<span class="op">$</span>tab.w <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">synth_weights =</span> w.weights) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(synth_weights, unit.numbers), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;state_number&quot;</span> =<span class="st"> &quot;unit.numbers&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb120-20" title="20"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">synth_weights =</span> <span class="kw">replace</span>(synth_weights, state_number <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb120-21" title="21">}</a>
<a class="sourceLine" id="cb120-22" title="22"></a>
<a class="sourceLine" id="cb120-23" title="23">augsynth_tidy &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb120-24" title="24">  fit &lt;-<span class="st"> </span><span class="kw">augsynth</span>(prop_non_hispanic_below_hs <span class="op">~</span><span class="st"> </span>legal_worker_act, state, year, <span class="dt">t_int =</span> <span class="dv">2007</span>, <span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb120-25" title="25">  res &lt;-<span class="st"> </span><span class="kw">summary</span>(fit)<span class="op">$</span>att <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Time <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Estimate, Std.Error)</a>
<a class="sourceLine" id="cb120-26" title="26">  <span class="kw">names</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;estimate&quot;</span>, <span class="st">&quot;std.error&quot;</span>)</a>
<a class="sourceLine" id="cb120-27" title="27">  res<span class="op">$</span>p.value &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">pt</span>(<span class="op">-</span><span class="kw">abs</span>(res<span class="op">$</span>estimate<span class="op">/</span>res<span class="op">$</span>std.error), <span class="dt">df =</span> <span class="kw">nrow</span>(data) <span class="op">-</span><span class="st"> </span><span class="dv">15</span>)</a>
<a class="sourceLine" id="cb120-28" title="28">  res<span class="op">$</span>conf.low &lt;-<span class="st"> </span>res<span class="op">$</span>estimate <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>res<span class="op">$</span>std.error</a>
<a class="sourceLine" id="cb120-29" title="29">  res<span class="op">$</span>conf.high &lt;-<span class="st"> </span>res<span class="op">$</span>estimate <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>res<span class="op">$</span>std.error</a>
<a class="sourceLine" id="cb120-30" title="30">  res</a>
<a class="sourceLine" id="cb120-31" title="31">}</a>
<a class="sourceLine" id="cb120-32" title="32"></a>
<a class="sourceLine" id="cb120-33" title="33"><span class="co"># note need to clean up the range of the data, currently over 1</span></a>
<a class="sourceLine" id="cb120-34" title="34">design &lt;-</a>
<a class="sourceLine" id="cb120-35" title="35"><span class="st">  </span><span class="kw">declare_population</span>(</a>
<a class="sourceLine" id="cb120-36" title="36">    <span class="dt">states =</span> <span class="kw">add_level</span>(</a>
<a class="sourceLine" id="cb120-37" title="37">      <span class="dt">N =</span> <span class="dv">50</span>, </a>
<a class="sourceLine" id="cb120-38" title="38">      <span class="dt">state =</span> state.abb,</a>
<a class="sourceLine" id="cb120-39" title="39">      <span class="dt">state_number =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(state)),</a>
<a class="sourceLine" id="cb120-40" title="40">      <span class="dt">state_shock =</span> <span class="kw">runif</span>(N, <span class="fl">-.15</span>, <span class="fl">.15</span>),</a>
<a class="sourceLine" id="cb120-41" title="41">      <span class="dt">border_state =</span> state <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AZ&quot;</span>, <span class="st">&quot;CA&quot;</span>, <span class="st">&quot;NM&quot;</span>, <span class="st">&quot;TX&quot;</span>),</a>
<a class="sourceLine" id="cb120-42" title="42">      <span class="dt">state_shock =</span> <span class="kw">ifelse</span>(border_state, <span class="fl">.2</span>, state_shock)</a>
<a class="sourceLine" id="cb120-43" title="43">    ),</a>
<a class="sourceLine" id="cb120-44" title="44">    <span class="dt">years =</span> <span class="kw">add_level</span>(</a>
<a class="sourceLine" id="cb120-45" title="45">      <span class="dt">N =</span> <span class="dv">12</span>, <span class="dt">nest =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb120-46" title="46">      <span class="dt">year =</span> <span class="dv">1998</span><span class="op">:</span><span class="dv">2009</span>,</a>
<a class="sourceLine" id="cb120-47" title="47">      <span class="dt">post_treatment_period =</span> year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2007</span>,</a>
<a class="sourceLine" id="cb120-48" title="48">      <span class="dt">year_shock =</span> <span class="kw">runif</span>(N, <span class="fl">-.025</span>, <span class="fl">.025</span>), </a>
<a class="sourceLine" id="cb120-49" title="49">      <span class="dt">year_trend =</span> year <span class="op">-</span><span class="st"> </span><span class="dv">1998</span></a>
<a class="sourceLine" id="cb120-50" title="50">    ),</a>
<a class="sourceLine" id="cb120-51" title="51">    <span class="dt">obs =</span> <span class="kw">cross_levels</span>(</a>
<a class="sourceLine" id="cb120-52" title="52">      <span class="dt">by =</span> <span class="kw">join</span>(states, years),</a>
<a class="sourceLine" id="cb120-53" title="53">      <span class="co"># treatment indicator:</span></a>
<a class="sourceLine" id="cb120-54" title="54">      <span class="dt">legal_worker_act =</span> <span class="kw">if_else</span>(post_treatment_period <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> <span class="op">&amp;</span><span class="st"> </span>state <span class="op">==</span><span class="st"> &quot;AZ&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb120-55" title="55">      <span class="dt">state_year_shock =</span> <span class="kw">runif</span>(N, <span class="fl">-.025</span>, <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb120-56" title="56">      <span class="dt">prop_non_hispanic_below_hs_baseline =</span> </a>
<a class="sourceLine" id="cb120-57" title="57">        <span class="fl">0.4</span> <span class="op">+</span><span class="st"> </span>state_shock <span class="op">+</span><span class="st"> </span>year_shock <span class="op">+</span><span class="st"> </span>(.<span class="dv">01</span> <span class="op">+</span><span class="st"> </span><span class="fl">.05</span> <span class="op">*</span><span class="st"> </span>border_state) <span class="op">*</span><span class="st"> </span>year_trend <span class="op">+</span><span class="st"> </span>state_year_shock</a>
<a class="sourceLine" id="cb120-58" title="58">    )</a>
<a class="sourceLine" id="cb120-59" title="59">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-60" title="60"><span class="st">  </span><span class="kw">declare_potential_outcomes</span>(</a>
<a class="sourceLine" id="cb120-61" title="61">    prop_non_hispanic_below_hs <span class="op">~</span><span class="st"> </span>prop_non_hispanic_below_hs_baseline <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span> <span class="op">*</span><span class="st"> </span>legal_worker_act, </a>
<a class="sourceLine" id="cb120-62" title="62">    <span class="dt">assignment_variable =</span> legal_worker_act) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-63" title="63"><span class="st">  </span><span class="kw">declare_estimand</span>(</a>
<a class="sourceLine" id="cb120-64" title="64">    <span class="dt">ATE_AZ =</span> <span class="kw">mean</span>(prop_non_hispanic_below_hs_legal_worker_act_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb120-65" title="65"><span class="st">                    </span>prop_non_hispanic_below_hs_legal_worker_act_<span class="dv">0</span>), </a>
<a class="sourceLine" id="cb120-66" title="66">    <span class="dt">subset =</span> legal_worker_act <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-67" title="67"><span class="st">  </span><span class="kw">declare_reveal</span>(prop_non_hispanic_below_hs, legal_worker_act) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-68" title="68"><span class="st">  </span><span class="kw">declare_step</span>(<span class="dt">handler =</span> synth_weights_tidy) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-69" title="69"><span class="st">  </span><span class="kw">declare_estimator</span>(</a>
<a class="sourceLine" id="cb120-70" title="70">    prop_non_hispanic_below_hs <span class="op">~</span><span class="st"> </span>legal_worker_act, </a>
<a class="sourceLine" id="cb120-71" title="71">    <span class="dt">subset =</span> year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2007</span>, <span class="dt">weights =</span> synth_weights, <span class="dt">model =</span> lm_robust, <span class="dt">label =</span> <span class="st">&quot;synth&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-72" title="72"><span class="st">  </span><span class="kw">declare_estimator</span>(</a>
<a class="sourceLine" id="cb120-73" title="73">    prop_non_hispanic_below_hs <span class="op">~</span><span class="st"> </span>legal_worker_act, <span class="dt">subset =</span> year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2007</span>, </a>
<a class="sourceLine" id="cb120-74" title="74">    <span class="dt">model =</span> lm_robust, <span class="dt">label =</span> <span class="st">&quot;unweighted&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-75" title="75"><span class="st">  </span><span class="kw">declare_estimator</span>(</a>
<a class="sourceLine" id="cb120-76" title="76">    prop_non_hispanic_below_hs <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(state <span class="op">==</span><span class="st"> &quot;AZ&quot;</span>) <span class="op">+</span><span class="st"> </span>post_treatment_period <span class="op">+</span><span class="st"> </span>legal_worker_act, <span class="dt">term =</span> <span class="st">&quot;legal_worker_act&quot;</span>, </a>
<a class="sourceLine" id="cb120-77" title="77">    <span class="dt">model =</span> lm_robust, <span class="dt">label =</span> <span class="st">&quot;unweighted_did&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-78" title="78"><span class="st">  </span><span class="kw">declare_estimator</span>(<span class="dt">handler =</span> <span class="kw">tidy_estimator</span>(augsynth_tidy), <span class="dt">label =</span> <span class="st">&quot;augsynth&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1">state_data &lt;-<span class="st"> </span><span class="kw">draw_data</span>(design)</a>
<a class="sourceLine" id="cb121-2" title="2"></a>
<a class="sourceLine" id="cb121-3" title="3">state_data <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(state, synth_weights) <span class="op">%&gt;%</span><span class="st"> </span>distinct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span>synth_weights) <span class="op">%&gt;%</span><span class="st"> </span>head</a></code></pre></div>
<pre><code>##   state synth_weights
## 1    AZ         1.000
## 2    TX         0.942
## 3    NM         0.026
## 4    CA         0.016
## 5    AL         0.001
## 6    AK         0.001</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1">state_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb123-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb123-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(year, prop_non_hispanic_below_hs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb123-4" title="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>state)</a></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-323-1.png" width="672" /></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1">state_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">treatment_state =</span> <span class="kw">factor</span>(state <span class="op">==</span><span class="st"> &quot;AZ&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Synthethic Control&quot;</span>, <span class="st">&quot;Arizona&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(treatment_state, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-4" title="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop_non_hispanic_below_hs =</span> <span class="kw">weighted.mean</span>(prop_non_hispanic_below_hs, <span class="dt">w =</span> synth_weights)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> prop_non_hispanic_below_hs, <span class="dt">color =</span> treatment_state)) <span class="op">+</span></a>
<a class="sourceLine" id="cb124-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-7" title="7"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">2007</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-8" title="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw">pretty_breaks</span>()) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-9" title="9"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">2006.7</span>, <span class="dt">y =</span> <span class="fl">1.7</span>, <span class="dt">label =</span> <span class="st">&quot;Law Introduced in 2007&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">family =</span> <span class="st">&quot;Palatino&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb124-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb124-11" title="11"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Proportion Non-Hispanic Below H.S. Education&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb124-12" title="12"><span class="st">  </span><span class="kw">dd_theme</span>()</a></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-324-1.png" width="672" /></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1">simulations &lt;-<span class="st"> </span><span class="kw">simulate_design</span>(design, <span class="dt">sims =</span> sims)</a></code></pre></div>
<p>Now all that simulating, saving, and loading is done, and we can use the simulations for whatever you want.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1">synth_diagnosands &lt;-<span class="st"> </span><span class="kw">declare_diagnosands</span>(<span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;bias&quot;</span>, <span class="st">&quot;rmse&quot;</span>, <span class="st">&quot;coverage&quot;</span>))</a>
<a class="sourceLine" id="cb126-2" title="2"></a>
<a class="sourceLine" id="cb126-3" title="3">diagnosis &lt;-<span class="st"> </span><span class="kw">diagnose_design</span>(simulations, <span class="dt">diagnosands =</span> synth_diagnosands, <span class="dt">bootstrap_sims =</span> b_sims)</a>
<a class="sourceLine" id="cb126-4" title="4"></a>
<a class="sourceLine" id="cb126-5" title="5"><span class="kw">kable</span>(<span class="kw">reshape_diagnosis</span>(diagnosis))</a></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Design Label
</th>
<th style="text-align:left;">
Estimand Label
</th>
<th style="text-align:left;">
Estimator Label
</th>
<th style="text-align:left;">
Term
</th>
<th style="text-align:left;">
N Sims
</th>
<th style="text-align:left;">
Bias
</th>
<th style="text-align:left;">
RMSE
</th>
<th style="text-align:left;">
Coverage
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
design
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
augsynth
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.00
</td>
<td style="text-align:left;">
0.02
</td>
<td style="text-align:left;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.01)
</td>
</tr>
<tr>
<td style="text-align:left;">
design
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
synth
</td>
<td style="text-align:left;">
legal_worker_act
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.01
</td>
<td style="text-align:left;">
0.02
</td>
<td style="text-align:left;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
<tr>
<td style="text-align:left;">
design
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
unweighted
</td>
<td style="text-align:left;">
legal_worker_act
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.66
</td>
<td style="text-align:left;">
0.66
</td>
<td style="text-align:left;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
<tr>
<td style="text-align:left;">
design
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
unweighted_did
</td>
<td style="text-align:left;">
legal_worker_act
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.28
</td>
<td style="text-align:left;">
0.28
</td>
<td style="text-align:left;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
</tbody>
</table>
<ul>
<li>we see that Synth outperforms either method</li>
</ul>
<div id="when-there-are-not-good-controls-standard-synth-will-get-the-wrong-answer" class="section level3">
<h3><span class="header-section-number">16.6.1</span> When there are not good controls, standard synth will get the wrong answer</h3>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1"><span class="co"># declaration outside the convex hull</span></a>
<a class="sourceLine" id="cb127-2" title="2">design_outside_hull &lt;-<span class="st"> </span><span class="kw">replace_step</span>(</a>
<a class="sourceLine" id="cb127-3" title="3">  design, </a>
<a class="sourceLine" id="cb127-4" title="4">  <span class="dt">step =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb127-5" title="5">  <span class="dt">new_step =</span> <span class="kw">declare_potential_outcomes</span>(</a>
<a class="sourceLine" id="cb127-6" title="6">    prop_non_hispanic_below_hs <span class="op">~</span><span class="st"> </span>prop_non_hispanic_below_hs_baseline <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span> <span class="op">*</span><span class="st"> </span>legal_worker_act <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>(state <span class="op">==</span><span class="st"> &quot;AZ&quot;</span>), </a>
<a class="sourceLine" id="cb127-7" title="7">    <span class="dt">assignment_variable =</span> legal_worker_act))</a>
<a class="sourceLine" id="cb127-8" title="8"></a>
<a class="sourceLine" id="cb127-9" title="9">state_data_outside_hull &lt;-<span class="st"> </span><span class="kw">draw_data</span>(design_outside_hull)</a></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1">simulations_outside_hull &lt;-<span class="st"> </span><span class="kw">simulate_design</span>(design_outside_hull, <span class="dt">sims =</span> sims)</a></code></pre></div>
<p>Now all that simulating, saving, and loading is done, and we can use the simulations for whatever you want.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">diagnosis_outside_hull &lt;-<span class="st"> </span><span class="kw">diagnose_design</span>(simulations_outside_hull, <span class="dt">diagnosands =</span> synth_diagnosands, <span class="dt">bootstrap_sims =</span> b_sims)</a>
<a class="sourceLine" id="cb129-2" title="2"></a>
<a class="sourceLine" id="cb129-3" title="3"><span class="kw">kable</span>(<span class="kw">reshape_diagnosis</span>(diagnosis_outside_hull))</a></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Design Label
</th>
<th style="text-align:left;">
Estimand Label
</th>
<th style="text-align:left;">
Estimator Label
</th>
<th style="text-align:left;">
Term
</th>
<th style="text-align:left;">
N Sims
</th>
<th style="text-align:left;">
Bias
</th>
<th style="text-align:left;">
RMSE
</th>
<th style="text-align:left;">
Coverage
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
design_outside_hull
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
augsynth
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
-0.01
</td>
<td style="text-align:left;">
0.03
</td>
<td style="text-align:left;">
0.75
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.01)
</td>
</tr>
<tr>
<td style="text-align:left;">
design_outside_hull
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
synth
</td>
<td style="text-align:left;">
legal_worker_act
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.20
</td>
<td style="text-align:left;">
0.20
</td>
<td style="text-align:left;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
<tr>
<td style="text-align:left;">
design_outside_hull
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
unweighted
</td>
<td style="text-align:left;">
legal_worker_act
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.86
</td>
<td style="text-align:left;">
0.86
</td>
<td style="text-align:left;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
<tr>
<td style="text-align:left;">
design_outside_hull
</td>
<td style="text-align:left;">
ATE_AZ
</td>
<td style="text-align:left;">
unweighted_did
</td>
<td style="text-align:left;">
legal_worker_act
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
0.28
</td>
<td style="text-align:left;">
0.28
</td>
<td style="text-align:left;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
<td style="text-align:left;">
(0.00)
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1"><span class="co"># plot the synthetic control constructed in this way (it usually picks just texas and is highly biased)</span></a>
<a class="sourceLine" id="cb130-2" title="2">state_data_outside_hull <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">treatment_state =</span> <span class="kw">factor</span>(state <span class="op">==</span><span class="st"> &quot;AZ&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Synthethic Control&quot;</span>, <span class="st">&quot;Arizona&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(treatment_state, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prop_non_hispanic_below_hs =</span> <span class="kw">weighted.mean</span>(prop_non_hispanic_below_hs, <span class="dt">w =</span> synth_weights)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-6" title="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> prop_non_hispanic_below_hs, <span class="dt">color =</span> treatment_state)) <span class="op">+</span></a>
<a class="sourceLine" id="cb130-7" title="7"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-8" title="8"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">2007</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-9" title="9"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw">pretty_breaks</span>()) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-10" title="10"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">2006.7</span>, <span class="dt">y =</span> <span class="fl">1.7</span>, <span class="dt">label =</span> <span class="st">&quot;Law Introduced in 2007&quot;</span>, <span class="dt">hjust =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">family =</span> <span class="st">&quot;Palatino&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb130-11" title="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb130-12" title="12"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Proportion Non-Hispanic Below H.S. Education&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb130-13" title="13"><span class="st">  </span><span class="kw">dd_theme</span>()</a></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-332-1.png" width="672" /></p>
</div>
<div id="references-1" class="section level3">
<h3><span class="header-section-number">16.6.2</span> References</h3>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="process-tracing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="policing-and-post-treatment-bias.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false,
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
