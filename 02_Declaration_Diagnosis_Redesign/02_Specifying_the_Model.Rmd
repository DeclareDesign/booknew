---
title: "Specifying the model"
output:
  html_document:
    toc: true
    toc_depth: 2
---

<!-- note do_bookdown is set in index.rmd, so we know if you are running just this .Rmd or compiling the book-->
```{r, eval = !exists("do_bookdown"), echo = FALSE, include = FALSE, purl = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()) # files are all relative to RStudio project home
```

```{r, eval = !exists("do_bookdown"), echo = FALSE, include = FALSE, purl = FALSE}
# load common packages, set ggplot ddtheme, etc.
source("scripts/before_chapter_script.R")
```

<!-- start post here, do not edit above -->

# Specifying the model

<!-- make sure to rename the section title below -->

```{r specifying_the_model, echo = FALSE, output = FALSE, purl = FALSE}
# run the diagnosis (set to TRUE) on your computer for this section only before pushing to Github. no diagnosis will ever take place on github.
do_diagnosis <- FALSE
sims <- 100
b_sims <- 20
```

```{r, echo = FALSE}
# load packages for this section here. note many (DD, tidyverse) are already available, see scripts/package-list.R
library(dagitty)
library(dddag)
library(ggraph)
```


## Two languages for describing causal models

Any research design -- whether the research question is fundamentally causal or descriptive -- implicitly relies on a causal model of the world. These models include beliefs about what variables are important and how they interrelate. Even if the model is hazy, researchers carry with them a model of the world that could in principle be expressed as a probablistic causal model. As described in the previous chapter, probabalistic causal models are described by a set of exogeneous and endogenous variables, a set of functional relationships between the variables, and a probability distribution over the exogenous variables. 

In order to design a strong research study, we need to introspect about our causal beliefs. We need to make the explicit the design-relevant features of the implicit causal models in our heads. This chapter is about how to go about this difficult task. 

We make use of two different formal languages for describing causal models: DAGs and potential outcomes. DAGs are "directed acyclic graphs," where each node on a graph is a variable and the edges that connect them represent causal effects. DAGs emphasize a mechanical notion of causality: when the exposure variable changes, the outcome variable changes as a result. 



By contrast, the potential outcomes formalization emphasizes a counterfactual notion of causality. $Y_i(0)$ is the outcome for unit $i$ when the exposure variable is set to zero and $Y_i(1)$ is the outcome when it is set to one. The difference between them is the effect of the treatment on the outcome for unit $i$. Since at most only one potential outcome can ever be revealed, at least one of the two potential outcomes is necessarily counterfactual. Unrevealed potential outcomes are counter-to-facts; they do not exist. Nevertheless, the potential outcomes model is useful for thinking about what would have happened had things been different.

Despite what you may have inferred from the sometimes heated disagreements between scholars who prefer one formalization to the other, DAGs and potential outcomes are compatible systems for thinking about causality. A theorem in one language is a theorem in the other (CITE). We use both languages because they are useful for expressing different facets of research design. We'll take the example of heterogeneous treatment effects to show how the two languages convey different aspects of the research setting.


### Directed acyclic graphs (nonparameteric structural causal models)

- a set of functionals that relate causal variables to each other
- graphical representation of NSCM is a DAG

useful for:
- defining how variables relate (and do not)
- clarifying what estimands can (and cannot) be identified using research

### Potential outcomes (parametric structural causal models)

we get a ton from nonparametric causal models, but in order to assess many properties of a research design we need to parameterize them. we need to specify the scales and probability distribution of exogenous variables and the functional forms of the endogenous variables (how they relate to parent variables). this will include definining expectations about effect sizes but also correlations between variables, intra-class correlations (ICCs), and interactions.

useful for:
- simulating data as it will actually be collected
- diagnosing properties of a research design such as bias and power

## What variables belong in the causal model?

- infinite variables out there in the world, we don't have time (or need) to specify them all
- we are going to select those that are relevant to defining I, D, and A
- for I, we will need the outcomes or potential outcomes that define average effects or average treatment effects
- for D, we will need all the variables that we use to stratify, block, cluster, and measure
- for A, we will need all the variables that we control for, use to calculate clustered standard errors, for poststratification and calculation of weights, and visualize our data
- there will be many factors that affect our outcomes and independent variables that we do not specify explicitly, and these will be included as "unknown heterogeneity" -- and we will have to specify the importance of these unknown factors
- some of these variables will be exogenous and endogenous, in Pearl's terms. by exogenous variables, he means variables without parents, no antecendent causes. by endogenous variables, he means those with parents, that are determined in part by earlier variables. endogenous variables are distinct from the problem of endogeneity, which comes from a single variable being a parent of both the treatment variable of interest and the outcome we wish to measure the causal effect of the treatment on. we will use it in Pearl's sense.

## What do we need to specify about these variables?



