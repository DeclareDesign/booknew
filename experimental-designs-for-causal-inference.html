<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Experimental designs for causal inference | Research Design: Declare, Diagnose, Redesign</title>
<meta name="author" content="Graeme Blair, Alexander Coppock, and Macartan Humphreys">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<link href="libs/bs4_book-1.0.0/dd_imgpopup.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/bs4_book-1.0.0/dd_imgpopup.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://hypothes.is/embed.js" async></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Research Design: Declare, Diagnose, Redesign</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li class="book-part">Introduction</li>
<li><a class="" href="preamble.html"><span class="header-section-number">1</span> Preamble</a></li>
<li><a class="" href="improving-research-designs.html"><span class="header-section-number">2</span> Improving research designs</a></li>
<li><a class="" href="primer.html"><span class="header-section-number">3</span> Software primer</a></li>
<li><a class="" href="part-i-exercises.html"><span class="header-section-number">4</span> Part I Exercises</a></li>
<li class="book-part">Declaration, Diagnosis, Redesign</li>
<li><a class="" href="declaration.html"><span class="header-section-number">5</span> Declaration</a></li>
<li><a class="" href="specifying-the-model.html"><span class="header-section-number">6</span> Specifying the model</a></li>
<li><a class="" href="defining-the-inquiry.html"><span class="header-section-number">7</span> Defining the inquiry</a></li>
<li><a class="" href="crafting-a-data-strategy.html"><span class="header-section-number">8</span> Crafting a data strategy</a></li>
<li><a class="" href="choosing-an-answer-strategy.html"><span class="header-section-number">9</span> Choosing an answer strategy</a></li>
<li><a class="" href="p2diagnosis.html"><span class="header-section-number">10</span> Diagnosis</a></li>
<li><a class="" href="redesign-2.html"><span class="header-section-number">11</span> Redesign</a></li>
<li><a class="" href="part-ii-exercises.html"><span class="header-section-number">12</span> Part II Exercises</a></li>
<li class="book-part">Research Design Library</li>
<li><a class="" href="research-design-library.html"><span class="header-section-number">13</span> Research Design Library</a></li>
<li><a class="" href="observational-designs-for-descriptive-inference.html"><span class="header-section-number">14</span> Observational designs for descriptive inference</a></li>
<li><a class="" href="experimental-designs-for-descriptive-inference.html"><span class="header-section-number">15</span> Experimental designs for descriptive inference</a></li>
<li><a class="" href="observational-designs-for-causal-inference.html"><span class="header-section-number">16</span> Observational designs for causal inference</a></li>
<li><a class="active" href="experimental-designs-for-causal-inference.html"><span class="header-section-number">17</span> Experimental designs for causal inference</a></li>
<li><a class="" href="multi-study-designs.html"><span class="header-section-number">18</span> Multi-study designs</a></li>
<li><a class="" href="part-iii-exercises.html"><span class="header-section-number">19</span> Part III Exercises</a></li>
<li class="book-part">Research Design Lifecycle</li>
<li><a class="" href="research-design-lifecycle.html"><span class="header-section-number">20</span> Research Design Lifecycle</a></li>
<li><a class="" href="before.html"><span class="header-section-number">21</span> Before</a></li>
<li><a class="" href="during.html"><span class="header-section-number">22</span> During</a></li>
<li><a class="" href="after.html"><span class="header-section-number">23</span> After</a></li>
<li><a class="" href="part-iv-exercises.html"><span class="header-section-number">24</span> Part IV Exercises</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="experimental-designs-for-causal-inference" class="section level1">
<h1>
<span class="header-section-number">17</span> Experimental designs for causal inference<a class="anchor" aria-label="anchor" href="#experimental-designs-for-causal-inference"><i class="fas fa-link"></i></a>
</h1>
<p>Section introduction</p>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
<!-- make sure to rename the section title below -->
<div id="two-arm-trials-1" class="section level2">
<h2>
<span class="header-section-number">17.1</span> Two arm trials<a class="anchor" aria-label="anchor" href="#two-arm-trials-1"><i class="fas fa-link"></i></a>
</h2>
<p><span style="color: red;"><small>[FLAG]</small></span></p>
<div id="declaration-16" class="section level3">
<h3>
<span class="header-section-number">17.1.1</span> Declaration<a class="anchor" aria-label="anchor" href="#declaration-16"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span>
  <span class="fu">declare_population</span><span class="op">(</span>N <span class="op">=</span> <span class="fl">100</span>, U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">U</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>ATE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span></code></pre></div>
</div>
<div id="dag-15" class="section level3">
<h3>
<span class="header-section-number">17.1.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-15"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-282-1.svg" width="100%"></div>
</div>
<div id="example-11" class="section level3">
<h3>
<span class="header-section-number">17.1.3</span> Example<a class="anchor" aria-label="anchor" href="#example-11"><i class="fas fa-link"></i></a>
</h3>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
</div>
</div>
<div id="blocked-trials" class="section level2">
<h2>
<span class="header-section-number">17.2</span> Blocked trials<a class="anchor" aria-label="anchor" href="#blocked-trials"><i class="fas fa-link"></i></a>
</h2>
<div id="declaration-17" class="section level3">
<h3>
<span class="header-section-number">17.2.1</span> Declaration<a class="anchor" aria-label="anchor" href="#declaration-17"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span>
  <span class="fu">declare_population</span><span class="op">(</span>N <span class="op">=</span> <span class="fl">100</span>,
                     X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span>,
                     U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">X</span> <span class="op">+</span> <span class="va">U</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>ATE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>blocks <span class="op">=</span> <span class="va">X</span>, block_prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>, label <span class="op">=</span> <span class="st">"Naive DIM"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,
                    blocks <span class="op">=</span> <span class="va">X</span>,
                    estimand <span class="op">=</span> <span class="st">"ATE"</span>,
                    label <span class="op">=</span> <span class="st">"Blocked DIM"</span><span class="op">)</span></code></pre></div>
</div>
<div id="dag-16" class="section level3">
<h3>
<span class="header-section-number">17.2.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-16"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-288-1.svg" width="100%"></div>
</div>
<div id="example-12" class="section level3">
<h3>
<span class="header-section-number">17.2.3</span> Example<a class="anchor" aria-label="anchor" href="#example-12"><i class="fas fa-link"></i></a>
</h3>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
</div>
</div>
<div id="blocked-cluster-trials" class="section level2">
<h2>
<span class="header-section-number">17.3</span> Blocked cluster trials<a class="anchor" aria-label="anchor" href="#blocked-cluster-trials"><i class="fas fa-link"></i></a>
</h2>
<div id="declaration-18" class="section level3">
<h3>
<span class="header-section-number">17.3.1</span> Declaration<a class="anchor" aria-label="anchor" href="#declaration-18"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    V <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>
      N <span class="op">=</span> <span class="fl">100</span>,
      X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span>,
      Q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
    <span class="op">)</span>,
    I <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="fl">5</span>,
                  U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">U</span> <span class="op">+</span> <span class="va">Q</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>ATE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>clusters <span class="op">=</span> <span class="va">V</span>,
                     blocks <span class="op">=</span> <span class="va">X</span>,
                     block_prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,
                    model <span class="op">=</span> <span class="va">difference_in_means</span>,
                    estimand <span class="op">=</span> <span class="st">"ATE"</span>,
                    label <span class="op">=</span> <span class="st">"Naive DIM"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span>
    <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,
    clusters <span class="op">=</span> <span class="va">V</span>,
    blocks <span class="op">=</span> <span class="va">X</span>,
    model <span class="op">=</span> <span class="va">difference_in_means</span>,
    estimand <span class="op">=</span> <span class="st">"ATE"</span>,
    label <span class="op">=</span> <span class="st">"Blocked and Clustered DIM"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span>
    <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,
    clusters <span class="op">=</span> <span class="va">V</span>,
    fixed_effects <span class="op">=</span> <span class="va">X</span>,
    model <span class="op">=</span> <span class="va">lm_robust</span>,
    estimand <span class="op">=</span> <span class="st">"ATE"</span>,
    label <span class="op">=</span> <span class="st">"Naive FE"</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="dag-17" class="section level3">
<h3>
<span class="header-section-number">17.3.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-17"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-294-1.svg" width="100%"></div>
</div>
<div id="example-13" class="section level3">
<h3>
<span class="header-section-number">17.3.3</span> Example<a class="anchor" aria-label="anchor" href="#example-13"><i class="fas fa-link"></i></a>
</h3>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
<!-- make sure to rename the section title below -->
</div>
</div>
<div id="multiarm-designs" class="section level2">
<h2>
<span class="header-section-number">17.4</span> Multiarm Designs<a class="anchor" aria-label="anchor" href="#multiarm-designs"><i class="fas fa-link"></i></a>
</h2>
<div id="declaration-19" class="section level3">
<h3>
<span class="header-section-number">17.4.1</span> Declaration<a class="anchor" aria-label="anchor" href="#declaration-19"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="dag-18" class="section level3">
<h3>
<span class="header-section-number">17.4.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-18"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="example-14" class="section level3">
<h3>
<span class="header-section-number">17.4.3</span> Example<a class="anchor" aria-label="anchor" href="#example-14"><i class="fas fa-link"></i></a>
</h3>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
<!-- make sure to rename the section title below -->
</div>
</div>
<div id="encouragement-designs" class="section level2">
<h2>
<span class="header-section-number">17.5</span> Encouragement designs<a class="anchor" aria-label="anchor" href="#encouragement-designs"><i class="fas fa-link"></i></a>
</h2>
<div id="declaration-20" class="section level3">
<h3>
<span class="header-section-number">17.5.1</span> Declaration<a class="anchor" aria-label="anchor" href="#declaration-20"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">direct_effect_of_encouragement</span> <span class="op">&lt;-</span> <span class="fl">0.0</span>
<span class="va">proportion_defiers</span> <span class="op">&lt;-</span> <span class="fl">0.0</span>

<span class="va">design</span> <span class="op">&lt;-</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    N <span class="op">=</span> <span class="fl">100</span>,
    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Always-Taker"</span>, <span class="st">"Never-Taker"</span>, <span class="st">"Complier"</span>, <span class="st">"Defier"</span><span class="op">)</span>,
      prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.8</span>, <span class="fl">0.0</span><span class="op">)</span>,
      size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>,
    U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span>
    <span class="va">D</span> <span class="op">~</span> <span class="fu">case_when</span><span class="op">(</span>
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Always-Taker"</span>, <span class="st">"Complier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never-Taker"</span>, <span class="st">"Defier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never-Taker"</span>, <span class="st">"Complier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Always-Taker"</span>, <span class="st">"Defier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span>
    <span class="va">Y</span> <span class="op">~</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Complier"</span><span class="op">)</span> <span class="op">*</span> <span class="va">D</span> <span class="op">+</span>
      <span class="fl">0.25</span> <span class="op">*</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Always-Taker"</span><span class="op">)</span> <span class="op">*</span> <span class="va">D</span> <span class="op">+</span>
      <span class="fl">0.75</span> <span class="op">*</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Defier"</span><span class="op">)</span> <span class="op">*</span> <span class="va">D</span> <span class="op">+</span>
      <span class="co"># Building in NO excludability violation</span>
      <span class="fl">0</span> <span class="op">*</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">U</span>,
    assignment_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"Z"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>CACE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_D_1_Z_1</span> <span class="op">-</span> <span class="va">Y_D_0_Z_0</span><span class="op">)</span>,
                   subset <span class="op">=</span> <span class="va">type</span> <span class="op">==</span> <span class="st">"Complier"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">D</span>, assignment_variable <span class="op">=</span> <span class="st">"Z"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">Y</span>, assignment_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">|</span> <span class="va">Z</span>, model <span class="op">=</span> <span class="va">iv_robust</span>, estimand <span class="op">=</span> <span class="st">"CACE"</span><span class="op">)</span></code></pre></div>
</div>
<div id="dag-19" class="section level3">
<h3>
<span class="header-section-number">17.5.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-19"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-305-1.svg" width="100%"></div>
</div>
<div id="example-15" class="section level3">
<h3>
<span class="header-section-number">17.5.3</span> Example<a class="anchor" aria-label="anchor" href="#example-15"><i class="fas fa-link"></i></a>
</h3>
<p>To do: demonstrate how violations of no defiers and excludability leads to bias.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Always-Taker"</span>, <span class="st">"Never-Taker"</span>, <span class="st">"Complier"</span>, <span class="st">"Defier"</span><span class="op">)</span>
<span class="va">direct_effect_of_encouragement</span> <span class="op">&lt;-</span> <span class="fl">0.0</span>
<span class="va">proportion_defiers</span> <span class="op">&lt;-</span> <span class="fl">0.0</span>

<span class="va">design</span> <span class="op">&lt;-</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    N <span class="op">=</span> <span class="fl">500</span>,
    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>
      <span class="va">types</span>,
      <span class="va">N</span>,
      replace <span class="op">=</span> <span class="cn">TRUE</span>,
      prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.8</span> <span class="op">-</span> <span class="va">proportion_defiers</span>, <span class="va">proportion_defiers</span><span class="op">)</span>
    <span class="op">)</span>,
    noise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span>
    <span class="va">D</span> <span class="op">~</span> <span class="fu">case_when</span><span class="op">(</span>
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never-Taker"</span>, <span class="st">"Complier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never-Taker"</span>, <span class="st">"Defier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Always-Taker"</span>, <span class="st">"Defier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,
      <span class="va">Z</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Always-Taker"</span>, <span class="st">"Complier"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span>
    <span class="va">Y</span> <span class="op">~</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Complier"</span><span class="op">)</span> <span class="op">*</span> <span class="va">D</span> <span class="op">+</span>
      <span class="fl">0.25</span> <span class="op">*</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Always-Taker"</span><span class="op">)</span> <span class="op">*</span> <span class="va">D</span> <span class="op">+</span>
      <span class="fl">0.75</span> <span class="op">*</span> <span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Defier"</span><span class="op">)</span> <span class="op">*</span> <span class="va">D</span> <span class="op">+</span>
      <span class="va">direct_effect_of_encouragement</span> <span class="op">*</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">noise</span>,
    assignment_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"Z"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>CACE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">Y_D_1_Z_1</span> <span class="op">+</span> <span class="va">Y_D_1_Z_0</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">-</span>
                                 <span class="op">(</span><span class="va">Y_D_0_Z_1</span> <span class="op">+</span> <span class="va">Y_D_0_Z_0</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,
                   subset <span class="op">=</span> <span class="va">type</span> <span class="op">==</span> <span class="st">"Complier"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">D</span>, assignment_variable <span class="op">=</span> <span class="st">"Z"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">Y</span>, assignment_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">|</span> <span class="va">Z</span>, model <span class="op">=</span> <span class="va">iv_robust</span>, estimand <span class="op">=</span> <span class="st">"CACE"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">designs</span> <span class="op">&lt;-</span> <span class="fu">redesign</span><span class="op">(</span>
  <span class="va">design</span>,
  proportion_defiers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,
  direct_effect_of_encouragement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">simulations_df</span> <span class="op">&lt;-</span> <span class="fu">simulate_design</span><span class="op">(</span><span class="va">designs</span>, sims <span class="op">=</span> <span class="va">sims</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-309-1.svg" width="100%"></div>

<!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book-->
<!-- start post here, do not edit above -->
</div>
</div>
<div id="stepped-wedge-designs" class="section level2">
<h2>
<span class="header-section-number">17.6</span> Stepped wedge designs<a class="anchor" aria-label="anchor" href="#stepped-wedge-designs"><i class="fas fa-link"></i></a>
</h2>
<p>In a stepped wedge design, individuals are randomly assigned to enter into treatment in different stages and at each stage their outcomes are remeasured. Figure <a href="experimental-designs-for-causal-inference.html#fig:steppedwedge">17.1</a> illustrates where the study gets its name: as two units are randomly added to the treatment group in each of the three waves, the treatment group increases in “steps” while the control group diminishes.</p>
<p>Often, stepped wedge designs are vaunted for their policy appeal because they allow for everyone to be (eventually) treated in the context of an experiment. However, you could achieve the same goal in a regular two-arm trial by treating everyone after the final wave of measurement, and not all stepped wedge designs involve treating everyone. Beyond its ethical and logistical appeal, the design can squeeze more power out of a small sample by treating each wave as though it were its own study.</p>
<div id="declaration-21" class="section level3">
<h3>
<span class="header-section-number">17.6.1</span> Declaration<a class="anchor" aria-label="anchor" href="#declaration-21"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p><strong>M</strong>odel: Eight units are randomized and remeasured at three time points. Importantly, any unit at any given point in time reveals one of only two potential outcomes — treated or untreated. Their untreated potential outcomes consist of a unit- and a unit-period-specific shock. Treated potential outcomes increase relative to control potential outcome by a rate of 1 each period — in other words, there are bigger treatment effects in later periods.</p></li>
<li><p><strong>I</strong>nquiry: Our estimand is the average treatment effect over all units and periods in the sample. Averaged over the three periods, the ATE is (1 + 2 + 3) / 3 = 2.</p></li>
<li><p><strong>D</strong>ata strategy: Our assignment strategy adds two units (one-quarter of the total sample) to the treatment at random in each wave, leaving two units who are not treated in any wave at all—see the remaining two orange squares at the top-right corner of Figure <a href="experimental-designs-for-causal-inference.html#fig:steppedwedge">17.1</a>. Notice that, while every <em>unit</em> is assigned to a treatment wave with equal probability, each wave reveals treated and untreated potential outcomes of <em>unit-periods</em> with different probabilities. In the first wave, one-quarter of the units reveal their treated potential outcomes; in the second wave, one-half of the units reveal their treated potential outcomes, and in the final wave, three-quarters of the units reveal treated potential outcomes. In essence, our experiment is like a block-randomized trial, with unit-periods grouped into period-specific blocks that have differential probabilities of assignment.</p></li>
<li><p><strong>A</strong>nswer strategy: Just as in a block-randomized trial with differential probabilities, we need to take account of the fact that our assignment strategy “under-represents” treated potential outcomes in the first wave and “over-represents” them in the last wave. Inverse-propensity weights (IPWs) are one way to correct for such disparities. Each unit’s IPW is represented on Figure <a href="experimental-designs-for-causal-inference.html#fig:steppedwedge">17.1</a>. Using these weights, we get a “representative” estimate of the average control and treatment potential outcomes in each wave. If we didn’t apply the weights, we wouldn’t get a representative view of the unobserved potential outcomes we’re sampling, and our estimates would be biased. So what does all this buy us? We also declare a “two-arm” estimator that focuses on wave 2 only, where half of the units are in control and half in treatment. Diagnosis shows that all the remeasuring and randomizing gets us (.52 - .41) / .41 = 27% higher power.</p></li>
</ul>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    unit <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="fl">8</span>,
                     X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>,
    period <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>
      N <span class="op">=</span> <span class="fl">3</span>,
      time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span>,
      p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span>, <span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span>, <span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span>,
      nest <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">)</span>,
    obs <span class="op">=</span> <span class="fu">cross_levels</span><span class="op">(</span>by <span class="op">=</span> <span class="fu">join</span><span class="op">(</span><span class="va">unit</span>, <span class="va">period</span><span class="op">)</span>,
                       U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">U</span> <span class="op">+</span> <span class="va">Z</span> <span class="op">*</span> <span class="va">time</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>
    clusters <span class="op">=</span> <span class="va">unit</span>,
    conditions <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,
    assignment_variable <span class="op">=</span> <span class="st">"wave"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">time</span> <span class="op">&gt;=</span> <span class="va">wave</span><span class="op">)</span>,
                     ipw <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">Z</span> <span class="op">*</span> <span class="va">p</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">Z</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span>,
                     handler <span class="op">=</span> <span class="va">fabricate</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">Y</span>, <span class="va">Z</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>ATE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span>
    <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,
    model <span class="op">=</span> <span class="va">lm_robust</span>,
    estimand <span class="op">=</span> <span class="st">"ATE"</span>,
    label <span class="op">=</span> <span class="st">"1: Stepped Wedge"</span>,
    weights <span class="op">=</span> <span class="va">ipw</span>,
    clusters <span class="op">=</span> <span class="va">unit</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span>
    <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,
    model <span class="op">=</span> <span class="va">lm_robust</span>,
    estimand <span class="op">=</span> <span class="st">"ATE"</span>,
    label <span class="op">=</span> <span class="st">"2: Wave 2 Only"</span>,
    subset <span class="op">=</span> <span class="va">period</span> <span class="op">==</span> <span class="fl">2</span>
  <span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:steppedwedge"></span>
<img src="book_files/figure-html/steppedwedge-1.svg" alt="Illustration of random assignment in a stepped-wedge design." width="100%"><p class="caption">
Figure 17.1: Illustration of random assignment in a stepped-wedge design.
</p>
</div>
</div>
<div id="dag-20" class="section level3">
<h3>
<span class="header-section-number">17.6.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-20"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-315-1.svg" width="100%"></div>
</div>
<div id="example-16" class="section level3">
<h3>
<span class="header-section-number">17.6.3</span> Example<a class="anchor" aria-label="anchor" href="#example-16"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="exercises-6" class="section level3">
<h3>
<span class="header-section-number">17.6.4</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-6"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Add an answer strategy to the design that doesn’t include IPWs and diagnose the design.</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>How does this affect the bias in the estimates? Explain your answer.</li>
<li>Now change the potential outcomes function so that the treatment effect is constant across periods. How does this affect the bias? Explain your answer.</li>
<li>How does the relative power of the stepped-wedge over the single-period, two-arm trial change when the treatment effect is restricted to be constant across periods? Explain your answer.</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>Our design makes a subtle but crucial assumption about the potential outcomes: namely, that the treated potential outcome revealed in one period is the same irrespective of whether the unit was treated in the previous (or subsequent) periods. What would a violation of this assumption look like?</li>
</ol>
<!-- - Comparing 1 and 2, stepped wedge gives a big improvement in power, is --><!-- unbiased, and gets the coverage correct. Clearly better than just doing a --><!-- cross-section at wave 2.  --><!-- - Estimator 3 shows two pitfalls, however, that can lead us to overestimate --><!-- benefits of SW. --><!-- 1. First, it is biased: [explain how treated POs are more commonly observed in --><!-- periods when they're higher, we need to weight for this. How weights come about: --><!-- There is one way that a unit can be observed in a treated state in wave 1: they --><!-- are assigned to W1 with probability `p_W1`. There are two ways in which a unit --><!-- can be treated in wave 2: they are assigned in W1 with `p_W1` or in W2 with --><!-- `p_W2`. Because being assigned in W1 or in W2 are exclusive and independent --><!-- events, we can get the prob of being treated in any period by wave 2 by summing --><!-- the probs.] --><!-- 2. Second, standard errors are wrong. Units should be treated as clusters (draw --><!-- analogue to two-stage random assignment in saturation design?) --><!-- A natural question is how power changes as more or fewer units are assigned.  --><!-- Here, we consider variations on the stepped wedge design declared above, in  --><!-- which we hold constant at 3 the number of units assigned to the pure control,  --><!-- and shift an increasing proportion of the assignment to later waves. --><!-- ```{r} --><!-- designs <- list( --><!--   a = redesign(design, p_00 = 3/8, p_W1 =  3/8, p_W2 = 1/8, p_W3 = 1/8), --><!--   b = redesign(design, p_00 = 3/8, p_W1 =  2/8, p_W2 = 2/8, p_W3 = 1/8), --><!--   c = redesign(design, p_00 = 3/8, p_W1 =  2/8, p_W2 = 1/8, p_W3 = 2/8), --><!--   d = redesign(design, p_00 = 3/8, p_W1 =  1/8, p_W2 = 3/8, p_W3 = 1/8), --><!--   e = redesign(design, p_00 = 3/8, p_W1 =  1/8, p_W2 = 2/8, p_W3 = 2/8), --><!--   f = redesign(design, p_00 = 3/8, p_W1 =  1/8, p_W2 = 1/8, p_W3 = 3/8) --><!--   ) --><!-- ``` --><!-- ```{r, eval = do_diagnosis & !exists("do_bookdown")} --><!-- # Diagnose design --><!-- diagnoses <- diagnose_designs(designs) --><!-- ``` --><!-- ```{r, echo = FALSE, purl = FALSE} --><!-- # figure out where the dropbox path is, create the directory if it doesn't exist, and name the RDS file --><!-- rds_file_path <- paste0(get_dropbox_path("05_Stepped_Wedge_Designs.Rmd"), "/diagnoses.RDS") --><!-- if (do_diagnosis & !exists("do_bookdown")) { --><!--   write_rds(diagnoses, path = rds_file_path) --><!-- } --><!-- diagnoses <- read_rds(rds_file_path) --><!-- ``` --><!-- ```{r, echo = FALSE} --><!-- designs_data <- names(designs) %>%  --><!--   lapply(function(name) designs[[name]] %>%  --><!--            draw_data %>%  --><!--            mutate(design_id = name)) %>%  --><!--   do.call(what = rbind,args = .) %>%  --><!--   arrange(design_id,wave,i) %>%  --><!--   group_by(t,design_id) %>% --><!--   mutate(i = 1:n(), Assignment = ifelse(Z == 1, "Treatment", "Control"))  --><!-- diags <- diagnoses %>%  --><!--   get_diagnosands() %>%  --><!--   filter(estimator_label == "2: Weighted, clustered SW") %>%  --><!--   mutate( --><!--     design_name = paste0("Design ", design_label, ": W1 = ",8*p_W1, --><!--                          "; W2 = ", 8*p_W2,  --><!--                          "; W3 = ", 8*p_W3,",\nPower = ",round(power,2) --><!--                          ) --><!--   ) --><!-- designs_data <- left_join(designs_data, diags %>% select(design_name, design_label), by = c("design_id" = "design_label")) --><!-- designs_data %>%  --><!--   ggplot(aes(x = t, y = i, fill = Assignment)) + --><!--   geom_tile(color = "white") +  --><!--   scale_fill_manual(values = c(control_color, treatment_color)) + --><!--   dd_theme() + facet_wrap(~ design_name, nrow = 1) +  --><!--   scale_y_continuous("",labels = NULL) --><!-- ``` --><!-- - We see a monotonic decrease in the power as more of the sample is treated  --><!-- later. This occurs because treating units later means observing less of the --><!-- potential outcomes. The potential outcomes are more variant, so we're better --><!-- off when we observe more of them [I think!] --><!-- ### Spillovers --><!-- An important assumption is that the potential outcomes revealed are not a --><!-- function of what wave the unit entered into treatment. In other words, there are --><!-- no Show how, in case of such spillovers, you can just treat the effects as --><!-- different, but then you lose power gains (and possibly change estimand) --><!-- note do_bookdown is set in index.rmd, so we know if you're running just this .Rmd or compiling the book--><!-- start post here, do not edit above -->
</div>
</div>
<div id="randomized-saturation-design" class="section level2">
<h2>
<span class="header-section-number">17.7</span> Randomized Saturation Design<a class="anchor" aria-label="anchor" href="#randomized-saturation-design"><i class="fas fa-link"></i></a>
</h2>
<p>Randomized saturation designs are used to measure the diffusion of treatment effects throughout a pre-defined area or network (<span class="citation">Baird et al. (<a href="references.html#ref-bairdetal2018" role="doc-biblioref">2018</a>)</span>). The design works in two phases. First, entire areas or networks are randomly assigned to <em>saturations</em>, e.g. 0%, 25%, and 75% saturation. Then, in each network, units are individually assigned in proportions determined by the saturations: e.g., in the groups randomly assigned to 0%, none of the units are assigned to treatment, while in the groups assigned to 25% and 75%, one-quarter and three-quarters of the units are assigned to treatment, respectively. By comparing untreated units in the 0% groups to their <em>untreated</em> counterparts in the higher-saturation networks, researchers can estimate the indirect treatment effects that result from saturation-induced spillovers.</p>
<div id="declaration-22" class="section level3">
<h3>
<span class="header-section-number">17.7.1</span> Declaration<a class="anchor" aria-label="anchor" href="#declaration-22"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p><strong>M</strong>odel: There are four networks each comprised of four units. Units’ treatment assignment is a function of their network’s saturation assignment, which in turn defines the amount of spillover they receive. The spillover is equal to the proportion of units treated in the network. Potential outcomes are thus defined in terms of <code>S</code>—the unit’s group’s saturation—and <code>Z</code>—whether or not a unit is treated.</p></li>
<li><p><strong>I</strong>nquiry: There are two inquiries. First, we want to know the spillover, defined here as the average difference in outcomes when an untreated unit is in a high versus a low saturation network: <span class="math inline">\(\mathbb{E}[Y_i(Z_i = 0, S_i = \text{high})-Y_i(Z_i = 0, S_i = \text{low})]\)</span>. We also want to know the “direct effect”–e.g. what happens to those directly treated if we disregard spillovers. Here it is defined over potential outcomes that the experiment does not reveal, since no one is treated in low-saturation constituencies: <span class="math inline">\(\mathbb{E}[Y_i(Z_i = 1, S_i = \text{low})-Y_i(Z_i = 0, S_i = \text{low})]\)</span>.</p></li>
<li><p><strong>D</strong>ata strategy: We assign entire networks to low (0%) or and high (75%) saturation. We then randomize individuals within groups to treatment or control in the proportions dictated by the saturation. Thus, the saturation is cluster-randomized, whereas treatment is block-randomized.</p></li>
<li><p><strong>A</strong>nswer strategy: We weight each individual by the inverse of the probability that they find themselves in the condition they’re in. The estimator conditions on both the saturation effect and the direct treatment effect. Note that the standard errors are clustered at the network level to account for the clustering of the saturation assignment.</p></li>
</ul>
<!-- # ```{r} --><!-- # design <-  --><!-- #   declare_population(network = add_level(N = 4),  --><!-- #                      unit = add_level(N = 4, U = rnorm(N))) + --><!-- #   declare_assignment(assignment_variable = "S",  --><!-- #                      clusters = network,  --><!-- #                      conditions = c("low","high")) + --><!-- #   declare_assignment(prob = 0.25,  --><!-- #                      blocks = network,  --><!-- #                      assignment_variable = "Z_S_low") + --><!-- #   declare_assignment(prob = 0.75,  --><!-- #                      blocks = network,  --><!-- #                      assignment_variable = "Z_S_high") + --><!-- #   declare_step(spillover_low = ave(Z_S_low, network, FUN = mean),  --><!-- #                spillover_high = ave(Z_S_high, network, FUN = mean),handler = fabricate)  + --><!-- #   declare_potential_outcomes(Y ~ Z + spillover_low * (S == "low") +  --><!-- #                                Z * spillover_high * (S == "high") + U, --><!-- #                              conditions = list(Z = c(0, 1),  S = c("low", "high"))) + --><!-- #   declare_estimand(ate_saturation = mean(Y_Z_0_S_high - Y_Z_0_S_low), --><!-- #                    ate_no_spill = mean(Y_Z_1_S_low - Y_Z_0_S_low)) + --><!-- #   reveal_outcomes(Z,S) + --><!-- #   declare_step(ipw = 1 / ( --><!-- #     S_cond_prob * (Z_S_low_cond_prob * (S == "low") +  --><!-- #                      Z_S_high_cond_prob * (S == "high"))), --><!-- #     handler = fabricate) + --><!-- #   reveal_outcomes(Y, c(Z, S)) + --><!-- #   declare_estimator( --><!-- #     Y ~ Z * S, --><!-- #     clusters = network, --><!-- #     model = lm_robust, --><!-- #     term = c("Z", "Shigh"), --><!-- #     estimand = c("ate_no_spill", "ate_saturation"), --><!-- #     weight = ipw --><!-- #   ) --><!-- # ``` --><!--
JC Comment: I see that the previous version was far too complex but the updated version was
misleadingly simple. The POs need to be a function of the proportion of units treated, not
simply a fixed trait of the saturation category you're assigned to. As it was setup before,
I could set the saturations at all sorts of crazy values and it makes no difference, it was
basically a het-fx by blocks design. Also, the point and variance estimators were biased
because this design requires IPWing. To me, the minimally sufficient declaration has to
illustrate the design works in terms of bias and coverage in a DGP it was specifically
setup to handle.
--><div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">&lt;-</span>
  <span class="fu">declare_population</span><span class="op">(</span>
    group <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="fl">50</span>, X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>,
    unit <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="fl">50</span>, U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>clusters <span class="op">=</span> <span class="va">group</span>, conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"high"</span><span class="op">)</span>, assignment_variable <span class="op">=</span> <span class="va">S</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_step</span><span class="op">(</span>S_prob <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">S</span> <span class="op">==</span> <span class="st">"low"</span> <span class="op">~</span> <span class="fl">0.25</span>, <span class="va">S</span> <span class="op">==</span> <span class="st">"high"</span> <span class="op">~</span> <span class="fl">0.75</span><span class="op">)</span>, <span class="va">mutate</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_assignment</span><span class="op">(</span>blocks <span class="op">=</span> <span class="va">group</span>, prob_unit <span class="op">=</span> <span class="va">S_prob</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_step</span><span class="op">(</span>spillover <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">group</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>,
               handler <span class="op">=</span> <span class="va">fabricate</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu">declare_potential_outcomes</span><span class="op">(</span>
    <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">spillover</span> <span class="op">*</span> <span class="op">(</span><span class="va">S</span> <span class="op">==</span> <span class="st">"low"</span><span class="op">)</span> <span class="op">+</span> <span class="va">Z</span> <span class="op">*</span> <span class="va">spillover</span> <span class="op">*</span> <span class="op">(</span><span class="va">S</span> <span class="op">==</span> <span class="st">"high"</span><span class="op">)</span> <span class="op">+</span> <span class="va">X</span> <span class="op">+</span> <span class="va">U</span>,
    conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, S <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimand</span><span class="op">(</span>ATE_saturation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_0_S_high</span> <span class="op">-</span> <span class="va">Y_Z_0_S_low</span><span class="op">)</span>,
                   ate_no_spill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_1_S_low</span> <span class="op">-</span> <span class="va">Y_Z_0_S_low</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">Y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">S</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">S</span>,
                    weights <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">S_cond_prob</span> <span class="op">*</span> <span class="va">Z_cond_prob</span><span class="op">)</span>,
                    model <span class="op">=</span> <span class="va">lm_robust</span>,
                    term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Z"</span>, <span class="st">"Shigh"</span><span class="op">)</span>,
                    estimand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ATE_saturation"</span>, <span class="st">"ate_no_spill"</span><span class="op">)</span>,
                    label <span class="op">=</span> <span class="st">"main effect"</span><span class="op">)</span></code></pre></div>
<!-- # ```{r saturation, echo = FALSE} -->
<!-- # draw_data(design) %>%  -->
<!-- #   mutate( -->
<!-- #     label = paste0("Group ", group, "\nSaturation = ", S),  -->
<!-- #     Z = as.factor(Z) -->
<!-- #   ) %>%  -->
<!-- #   ggplot() + -->
<!-- #   geom_point(aes(y = 1, x = unit, shape = Z, color = Z))  + -->
<!-- #   facet_wrap(~ label, scales = "free", nrow = 1) + -->
<!-- #   theme(axis.title.y = element_blank(), -->
<!-- #     axis.text.y = element_blank(), -->
<!-- #     axis.ticks.y = element_blank(), -->
<!-- #     axis.line = element_blank())  -->
<!-- # ``` -->
</div>
<div id="dag-21" class="section level3">
<h3>
<span class="header-section-number">17.7.2</span> DAG<a class="anchor" aria-label="anchor" href="#dag-21"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="book_files/figure-html/unnamed-chunk-321-1.svg" width="100%"></div>
</div>
<div id="exercises-7" class="section level3">
<h3>
<span class="header-section-number">17.7.3</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-7"><i class="fas fa-link"></i></a>
</h3>
<!-- - Increase the saturation of the "low" condition from 0% to 25% and diagnose the design. Notice how this changes the mean saturation and direct effect estimands. Now set the saturations both equal to 25%. Explain why the two estimands do or do not change. -->
<ul>
<li><p>Setting the saturations back to their original values, remove the <code>weights</code> from the estimator. What happens to the bias? Explain your answer.</p></li>
<li>
<p>In the potential outcomes declaration for <code>Y</code>, add an interaction between the high saturation condition and <code>Z</code>, and diagnose the design with the saturations set to their original values of 0 and .75.</p>
<ol style="list-style-type: decimal">
<li>Why is the estimate of the ATE of the treatment biased whereas the estimate of the saturation effect is not?</li>
<li>Why can the researcher not simply estimate the interaction in this design?</li>
<li>Now increase the low saturation to 25% and add an interaction between <code>Z</code> and <code>S</code> to the estimator. Why does this make the design unbiased again?</li>
</ol>
</li>
</ul>
<!-- ### Online Appendix Applied Example --><!-- @asunka2019, for example, wanted to know if the presence of election monitors at ballot stations would displace violence and fraud to other ballot stations. They randomized constituencies to low, medium, and high levels of saturation, and then randomized ballot stations to have election monitoring or not in low, medium, or high concentrations, depending on the randomized saturation. In the original study, the authors did not include a zero-saturation condition. Here, we declare a simplified version of their design in which a zero-saturation condition is included.  --><!-- Main points to develop: --><!-- - Randomized saturation is great when you get the model right. Though, show how IPW reduces the power to detect main effect, especially if there's no spillover. --><!-- - Randomized saturation assumes a model that may be wrong. In particular, spillovers are restricted to containers. But this might not be correct. --><!-- ### Design Declaration --><!-- - **M**odel:  --><!-- Potential outcomes are defined in terms of `S`---the saturation---and `Z`---whether or not a ballot station is treated. We model spillovers in two ways. In the first, the amount of spillover that affects a unit is determined by how many other units in its network are treated. In the second, the amount of spillover a unit receives is determined by whether that unit's geographic neighbor is treated, irrespective of whether they share a network. --><!-- - **I**nquiry:  --><!-- We want to know the effect of having high and medium levels of saturation versus low saturation in the control: $\E[Y_i(Z_i = 0, S_i = \text{high})-Y_i(Z_i = 0, S_i = \text{low})]$ and $\E[Y_i(Z_i = 0, S_i = \text{medium})-Y_i(Z_i = 0, S_i = \text{low})]$. We also want to know the "direct effect"--e.g. what happens to those directly treated if we disregard spillovers. Here it is defined over potential outcomes that the experiment does not reveal, since no one is treated in low-saturation constituencies: $\E[Y_i(Z_i = 1, S_i = \text{low})-Y_i(Z_i = 0, S_i = \text{low})]$.   --><!-- - **D**ata strategy: We assign entire groups of individual ballot stations to one of three saturations: low (0%), medium (50%), and high (75%). We then randomize individuals within groups to treatment or control in the proportions dictated by the saturation. Thus, the saturation is cluster-randomized, whereas treatment is block-randomized. --><!-- - **A**nswer strategy: We weight each individual by the inverse of the probability that they find themselves in the condition they're in. To estimate spillovers, we run one regression comparing high and one regression comparing medium to low saturation control units. To estimate the direct effect, we run a regression of the outcome on the treatment indicatior on the full sample, controlling for saturation. --><!-- ```{r} --><!-- N_individuals <- 60 --><!-- N_groups <- 15 --><!-- G_per_saturation <- c(5,5,5) --><!-- design <-  --><!--   declare_population(N = N_individuals,  --><!--                      X = 1:N,  --><!--                      U = rnorm(N), --><!--                      G = ntile(X, N_groups)) +  --><!--   declare_assignment(assignment_variable = "S",  --><!--                      clusters = G,  --><!--                      conditions = c("low","med","high"), --><!--                      m_each = G_per_saturation) + --><!--   declare_assignment(prob = 0, --><!--                      blocks = G, --><!--                      assignment_variable = "Z_S_low") + --><!--   declare_assignment(prob = .5, --><!--                      blocks = G, --><!--                      assignment_variable = "Z_S_med") + --><!--   declare_assignment(prob = .75, --><!--                      blocks = G, --><!--                      assignment_variable = "Z_S_high") + --><!--   declare_step( --><!--     spillover_low = ave(Z_S_low, G, FUN = sum) * .1, --><!--     spillover_med = ave(Z_S_med, G, FUN = sum) * .1, --><!--     spillover_high = ave(Z_S_high, G, FUN = sum) * .1, --><!--     handler = fabricate, --><!--     label = "spillover")  + --><!--   declare_potential_outcomes( --><!--     Y ~ Z * -.20 + U +  --><!--       spillover_low * (S == "low") +  --><!--       spillover_med * (S == "med") +  --><!--       spillover_high * (S == "high"), --><!--     conditions = list(Z = c(0,1), S = c("low","med","high"))) + --><!--   declare_estimand(high = mean(Y_Z_0_S_high - Y_Z_0_S_low), --><!--                    med =  mean(Y_Z_0_S_med - Y_Z_0_S_low),  --><!--                    ate_no_spill = mean(Y_Z_1_S_low - Y_Z_0_S_low)) + --><!--   reveal_outcomes(Z,S) + --><!--   declare_step( --><!--     w = 1 / (S_cond_prob * (Z_S_low_cond_prob * (S == "low") +  --><!--                    Z_S_med_cond_prob * (S == "med") +  --><!--                    Z_S_high_cond_prob * (S == "high"))), --><!--     handler = fabricate) + --><!--   reveal_outcomes(Y,c(Z, S)) + --><!--   declare_estimator(model = lm_robust,  --><!--                     formula = Y ~ S, --><!--                     subset = Z == 0 & S %in% c("high","low"),  --><!--                     estimand = "high", --><!--                     weights = w, --><!--                     label = "high vs low") + --><!--   declare_estimator(model = lm_robust,  --><!--                     formula = Y ~ S, --><!--                     subset = Z == 0 & S %in% c("med","low"),  --><!--                     weights = w, --><!--                     estimand = "med", --><!--                     label = "med vs low") + --><!--   declare_estimator(model = lm_robust,  --><!--                     formula = Y ~ Z + S, --><!--                     term = "Z",  --><!--                     weights = w, --><!--                     estimand = "ate_no_spill", --><!--                     label = "main effect") --><!-- ``` --><!-- Here's what our hypothetical country looks like: --><!-- ```{r, echo=FALSE} --><!-- draw_data(design) %>%  --><!--   ggplot(aes(x = 1, y = X, color = as.factor(G))) + --><!--   geom_point() + --><!--   scale_color_discrete("Ballot station") + --><!--   scale_y_continuous("Latitude") + --><!--   scale_x_continuous("Longitude") + --><!--   geom_hline(yintercept = seq(1, N_individuals, by = N_individuals / N_groups) - .5) --><!-- ``` --><!-- Let's diagnose --><!-- ```{r, eval = do_diagnosis & !exists("do_bookdown")} --><!-- diagnosis <- diagnose_design(design, sims = sims) --><!-- ``` --><!-- ```{r, echo = FALSE, purl = FALSE} --><!-- # figure out where the dropbox path is, create the directory if it doesn't exist, and name the RDS file --><!-- rds_file_path <- paste0(get_dropbox_path("06_Randomized_Saturation_Designs"), "/diagnosis.RDS") --><!-- if (do_diagnosis & !exists("do_bookdown")) { --><!--   write_rds(diagnosis, path = rds_file_path) --><!-- } --><!-- diagnosis <- read_rds(rds_file_path) --><!-- ``` --><!-- Our diagnosis shows this design does a pretty great job, under this model of spillovers: --><!-- ```{r} --><!-- diagnosis %>% reshape_diagnosis() %>% kable() --><!-- ``` --><!-- - It's particularly nice, since we're able to estimate the direct effect (whose constitutive POs we never observe) by partialling out spillovers. --><!-- - Show here: power tradeoffs for main effects versus spillovers, in terms of  --><!--   proportion of sample allocated to the "low" versus other conditions --><!-- - and also in terms of IPW (equivalent sample size with everyone in the .5 condition) --><!-- Now, we consider a model of spillovers in which fraud is displaced latitudinally,  --><!-- from one neighbor to the next. Say, because there are roads traveling north and  --><!-- fraudsters disregard boundaries (in reality, they are unlikely to do so). --><!-- ```{r} --><!-- distal_design <- --><!--   replace_step( --><!--     design = design, --><!--     step = "spillover", --><!--     new_step = declare_step( --><!--       next_neighbor = c(N, 1:(N - 1)), --><!--       spillover_low = Z_S_low[next_neighbor], --><!--       spillover_med = Z_S_med[next_neighbor], --><!--       spillover_high = Z_S_high[next_neighbor], --><!--       handler = fabricate --><!--     ) --><!--   ) --><!-- ``` --><!-- ```{r, eval = do_diagnosis & !exists("do_bookdown")} --><!-- distal_diagnosis <- diagnose_design(distal_design, sims = sims) --><!-- ``` --><!-- ```{r, echo = FALSE, purl = FALSE} --><!-- # figure out where the dropbox path is, create the directory if it doesn't exist, and name the RDS file --><!-- rds_file_path <- paste0(get_dropbox_path("06_Randomized_Saturation_Designs"), "/distal_diagnosis.RDS") --><!-- if (do_diagnosis & !exists("do_bookdown")) { --><!--   write_rds(distal_diagnosis, path = rds_file_path) --><!-- } --><!-- distal_diagnosis <- read_rds(rds_file_path) --><!-- ``` --><!-- - When there are next-neighbor spillovers that ignore boundaries, the estimator is biased again --><!-- ```{r} --><!-- distal_diagnosis %>% reshape_diagnosis() %>% kable() --><!-- ``` -->
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="observational-designs-for-causal-inference.html"><span class="header-section-number">16</span> Observational designs for causal inference</a></div>
<div class="next"><a href="multi-study-designs.html"><span class="header-section-number">18</span> Multi-study designs</a></div>
</div></main><div id="on-this-page-nav" class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#experimental-designs-for-causal-inference"><span class="header-section-number">17</span> Experimental designs for causal inference</a></li>
<li>
<a class="nav-link" href="#two-arm-trials-1"><span class="header-section-number">17.1</span> Two arm trials</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#declaration-16"><span class="header-section-number">17.1.1</span> Declaration</a></li>
<li><a class="nav-link" href="#dag-15"><span class="header-section-number">17.1.2</span> DAG</a></li>
<li><a class="nav-link" href="#example-11"><span class="header-section-number">17.1.3</span> Example</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#blocked-trials"><span class="header-section-number">17.2</span> Blocked trials</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#declaration-17"><span class="header-section-number">17.2.1</span> Declaration</a></li>
<li><a class="nav-link" href="#dag-16"><span class="header-section-number">17.2.2</span> DAG</a></li>
<li><a class="nav-link" href="#example-12"><span class="header-section-number">17.2.3</span> Example</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#blocked-cluster-trials"><span class="header-section-number">17.3</span> Blocked cluster trials</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#declaration-18"><span class="header-section-number">17.3.1</span> Declaration</a></li>
<li><a class="nav-link" href="#dag-17"><span class="header-section-number">17.3.2</span> DAG</a></li>
<li><a class="nav-link" href="#example-13"><span class="header-section-number">17.3.3</span> Example</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#multiarm-designs"><span class="header-section-number">17.4</span> Multiarm Designs</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#declaration-19"><span class="header-section-number">17.4.1</span> Declaration</a></li>
<li><a class="nav-link" href="#dag-18"><span class="header-section-number">17.4.2</span> DAG</a></li>
<li><a class="nav-link" href="#example-14"><span class="header-section-number">17.4.3</span> Example</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#encouragement-designs"><span class="header-section-number">17.5</span> Encouragement designs</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#declaration-20"><span class="header-section-number">17.5.1</span> Declaration</a></li>
<li><a class="nav-link" href="#dag-19"><span class="header-section-number">17.5.2</span> DAG</a></li>
<li><a class="nav-link" href="#example-15"><span class="header-section-number">17.5.3</span> Example</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#stepped-wedge-designs"><span class="header-section-number">17.6</span> Stepped wedge designs</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#declaration-21"><span class="header-section-number">17.6.1</span> Declaration</a></li>
<li><a class="nav-link" href="#dag-20"><span class="header-section-number">17.6.2</span> DAG</a></li>
<li><a class="nav-link" href="#example-16"><span class="header-section-number">17.6.3</span> Example</a></li>
<li><a class="nav-link" href="#exercises-6"><span class="header-section-number">17.6.4</span> Exercises</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#randomized-saturation-design"><span class="header-section-number">17.7</span> Randomized Saturation Design</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#declaration-22"><span class="header-section-number">17.7.1</span> Declaration</a></li>
<li><a class="nav-link" href="#dag-21"><span class="header-section-number">17.7.2</span> DAG</a></li>
<li><a class="nav-link" href="#exercises-7"><span class="header-section-number">17.7.3</span> Exercises</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Research Design: Declare, Diagnose, Redesign</strong>" was written by Graeme Blair, Alexander Coppock, and Macartan Humphreys. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Supported by the Laura and John Arnold Foundation and Evidence in Governance and Politics.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
